function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./index-XiqWboAF.js","./index-DH0j_rAm.js","./index-BF3hy4Zw.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{m as $v,n as po,o as lt,t as rt,q as Zu,r as Xu,u as A,x as eh,v as th,w as Dv,y as ih,z as nu,A as ds,C as Av,D as Tv,R as qv,I as xi,G as jv,F as Me,J as Be,K as Qt,L as ms,M as vs,N as lr,O as Uv,Q as ou,U as Mv,W as kv,X as zv,Y as Lv,Z as Dt,$ as Vv,a0 as fo,a1 as go,a2 as ws,a3 as yo,a4 as rh,a5 as Ft,a6 as $t,a7 as cr,a8 as Kv,a9 as Hv,aa as Fv,ab as Jt,_ as Gv}from"./index-DH0j_rAm.js";const Bv=":";function Wv(a){const[r,i]=a.split(Bv);return{namespace:r,reference:i}}function Qv(a,r=[]){const i=[];return Object.keys(a).forEach(n=>{if(r.length&&!r.includes(n))return;const o=a[n];i.push(...o.accounts)}),i}function sh(a,r){return a.includes(":")?[a]:r.chains||[]}const nh="base10",De="base16",io="base64pad",mo="utf8",oh=0,ci=1,Jv=0,au=1,ro=12,vo=32;function Yv(){const a=eh.generateKeyPair();return{privateKey:rt(a.secretKey,De),publicKey:rt(a.publicKey,De)}}function so(){const a=th.randomBytes(vo);return rt(a,De)}function Zv(a,r){const i=eh.sharedKey(lt(a,De),lt(r,De),!0),n=new Dv(po.SHA256,i).expand(vo);return rt(n,De)}function Xv(a){const r=po.hash(lt(a,De));return rt(r,De)}function Ci(a){const r=po.hash(lt(a,mo));return rt(r,De)}function ew(a){return lt(`${a}`,nh)}function pr(a){return Number(rt(a,nh))}function tw(a){const r=ew(typeof a.type<"u"?a.type:oh);if(pr(r)===ci&&typeof a.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const i=typeof a.senderPublicKey<"u"?lt(a.senderPublicKey,De):void 0,n=typeof a.iv<"u"?lt(a.iv,De):th.randomBytes(ro),o=new ih.ChaCha20Poly1305(lt(a.symKey,De)).seal(n,lt(a.message,mo));return rw({type:r,sealed:o,iv:n,senderPublicKey:i})}function iw(a){const r=new ih.ChaCha20Poly1305(lt(a.symKey,De)),{sealed:i,iv:n}=fs(a.encoded),o=r.open(n,i);if(o===null)throw new Error("Failed to decrypt");return rt(o,mo)}function rw(a){if(pr(a.type)===ci){if(typeof a.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return rt(nu([a.type,a.senderPublicKey,a.iv,a.sealed]),io)}return rt(nu([a.type,a.iv,a.sealed]),io)}function fs(a){const r=lt(a,io),i=r.slice(Jv,au),n=au;if(pr(i)===ci){const y=n+vo,w=y+ro,S=r.slice(n,y),C=r.slice(y,w),O=r.slice(w);return{type:i,sealed:O,iv:C,senderPublicKey:S}}const o=n+ro,h=r.slice(n,o),d=r.slice(o);return{type:i,sealed:d,iv:h}}function sw(a,r){const i=fs(a);return ah({type:pr(i.type),senderPublicKey:typeof i.senderPublicKey<"u"?rt(i.senderPublicKey,De):void 0,receiverPublicKey:r==null?void 0:r.receiverPublicKey})}function ah(a){const r=(a==null?void 0:a.type)||oh;if(r===ci){if(typeof(a==null?void 0:a.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(a==null?void 0:a.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:r,senderPublicKey:a==null?void 0:a.senderPublicKey,receiverPublicKey:a==null?void 0:a.receiverPublicKey}}function cu(a){return a.type===ci&&typeof a.senderPublicKey=="string"&&typeof a.receiverPublicKey=="string"}var nw=Object.defineProperty,uu=Object.getOwnPropertySymbols,ow=Object.prototype.hasOwnProperty,aw=Object.prototype.propertyIsEnumerable,hu=(a,r,i)=>r in a?nw(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i,lu=(a,r)=>{for(var i in r||(r={}))ow.call(r,i)&&hu(a,i,r[i]);if(uu)for(var i of uu(r))aw.call(r,i)&&hu(a,i,r[i]);return a};const cw="ReactNative",Ge={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},uw="js";function wo(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function $i(){return!Xu()&&!!Zu()&&navigator.product===cw}function Di(){return!wo()&&!!Zu()&&!!Xu()}function dr(){return $i()?Ge.reactNative:wo()?Ge.node:Di()?Ge.browser:Ge.unknown}function hw(){var a;try{return $i()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(a=global.Application)==null?void 0:a.applicationId:void 0}catch{return}}function lw(a,r){let i=ds.parse(a);return i=lu(lu({},i),r),a=ds.stringify(i),a}function pw(){return $v()||{name:"",description:"",url:"",icons:[""]}}function dw(){if(dr()===Ge.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:i,Version:n}=global.Platform;return[i,n].join("-")}const a=Av();if(a===null)return"unknown";const r=a.os?a.os.replace(" ","").toLowerCase():"unknown";return a.type==="browser"?[r,a.name,a.version].join("-"):[r,a.version].join("-")}function fw(){var a;const r=dr();return r===Ge.browser?[r,((a=Tv())==null?void 0:a.host)||"unknown"].join(":"):r}function gw(a,r,i){const n=dw(),o=fw();return[[a,r].join("-"),[uw,i].join("-"),n,o].join("/")}function yw({protocol:a,version:r,relayUrl:i,sdkVersion:n,auth:o,projectId:h,useOnCloseEvent:d,bundleId:y}){const w=i.split("?"),S=gw(a,r,n),C={auth:o,ua:S,projectId:h,useOnCloseEvent:d||void 0,origin:y||void 0},O=lw(w[1]||"",C);return w[0]+"?"+O}function ai(a,r){return a.filter(i=>r.includes(i)).length===a.length}function ch(a){return Object.fromEntries(a.entries())}function uh(a){return new Map(Object.entries(a))}function Oi(a=A.FIVE_MINUTES,r){const i=A.toMiliseconds(a||A.FIVE_MINUTES);let n,o,h;return{resolve:d=>{h&&n&&(clearTimeout(h),n(d))},reject:d=>{h&&o&&(clearTimeout(h),o(d))},done:()=>new Promise((d,y)=>{h=setTimeout(()=>{y(new Error(r))},i),n=d,o=y})}}function ur(a,r,i){return new Promise(async(n,o)=>{const h=setTimeout(()=>o(new Error(i)),r);try{const d=await a;n(d)}catch(d){o(d)}clearTimeout(h)})}function hh(a,r){if(typeof r=="string"&&r.startsWith(`${a}:`))return r;if(a.toLowerCase()==="topic"){if(typeof r!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${r}`}else if(a.toLowerCase()==="id"){if(typeof r!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${r}`}throw new Error(`Unknown expirer target type: ${a}`)}function mw(a){return hh("topic",a)}function vw(a){return hh("id",a)}function lh(a){const[r,i]=a.split(":"),n={id:void 0,topic:void 0};if(r==="topic"&&typeof i=="string")n.topic=i;else if(r==="id"&&Number.isInteger(Number(i)))n.id=Number(i);else throw new Error(`Invalid target, expected id:number or topic:string, got ${r}:${i}`);return n}function Fe(a,r){return A.fromMiliseconds((r||Date.now())+A.toMiliseconds(a))}function Gt(a){return Date.now()>=A.toMiliseconds(a)}function de(a,r){return`${a}${r?`:${r}`:""}`}function Hn(a=[],r=[]){return[...new Set([...a,...r])]}async function ww({id:a,topic:r,wcDeepLink:i}){try{if(!i)return;const n=typeof i=="string"?JSON.parse(i):i;let o=n==null?void 0:n.href;if(typeof o!="string")return;o.endsWith("/")&&(o=o.slice(0,-1));const h=`${o}/wc?requestId=${a}&sessionTopic=${r}`,d=dr();d===Ge.browser?h.startsWith("https://")?window.open(h,"_blank","noreferrer noopener"):window.open(h,"_self","noreferrer noopener"):d===Ge.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(h)}catch(n){console.error(n)}}async function _w(a,r){try{return await a.getItem(r)||(Di()?localStorage.getItem(r):void 0)}catch(i){console.error(i)}}const bw="irn";function no(a){return(a==null?void 0:a.relay)||{protocol:bw}}function ps(a){const r=qv[a];if(typeof r>"u")throw new Error(`Relay Protocol not supported: ${a}`);return r}var Ew=Object.defineProperty,Iw=Object.defineProperties,Pw=Object.getOwnPropertyDescriptors,pu=Object.getOwnPropertySymbols,Sw=Object.prototype.hasOwnProperty,Rw=Object.prototype.propertyIsEnumerable,du=(a,r,i)=>r in a?Ew(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i,Ow=(a,r)=>{for(var i in r||(r={}))Sw.call(r,i)&&du(a,i,r[i]);if(pu)for(var i of pu(r))Rw.call(r,i)&&du(a,i,r[i]);return a},Nw=(a,r)=>Iw(a,Pw(r));function Cw(a,r="-"){const i={},n="relay"+r;return Object.keys(a).forEach(o=>{if(o.startsWith(n)){const h=o.replace(n,""),d=a[o];i[h]=d}}),i}function fu(a){a=a.includes("wc://")?a.replace("wc://",""):a,a=a.includes("wc:")?a.replace("wc:",""):a;const r=a.indexOf(":"),i=a.indexOf("?")!==-1?a.indexOf("?"):void 0,n=a.substring(0,r),o=a.substring(r+1,i).split("@"),h=typeof i<"u"?a.substring(i):"",d=ds.parse(h);return{protocol:n,topic:xw(o[0]),version:parseInt(o[1],10),symKey:d.symKey,relay:Cw(d),expiryTimestamp:d.expiryTimestamp?parseInt(d.expiryTimestamp,10):void 0}}function xw(a){return a.startsWith("//")?a.substring(2):a}function $w(a,r="-"){const i="relay",n={};return Object.keys(a).forEach(o=>{const h=i+r+o;a[o]&&(n[h]=a[o])}),n}function Dw(a){return`${a.protocol}:${a.topic}@${a.version}?`+ds.stringify(Nw(Ow({symKey:a.symKey},$w(a.relay)),{expiryTimestamp:a.expiryTimestamp}))}function Ai(a){const r=[];return a.forEach(i=>{const[n,o]=i.split(":");r.push(`${n}:${o}`)}),r}function Aw(a){const r=[];return Object.values(a).forEach(i=>{r.push(...Ai(i.accounts))}),r}function Tw(a,r){const i=[];return Object.values(a).forEach(n=>{Ai(n.accounts).includes(r)&&i.push(...n.methods)}),i}function qw(a,r){const i=[];return Object.values(a).forEach(n=>{Ai(n.accounts).includes(r)&&i.push(...n.events)}),i}function _o(a){return a.includes(":")}function nr(a){return _o(a)?a.split(":")[0]:a}const jw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Uw={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function R(a,r){const{message:i,code:n}=Uw[a];return{message:r?`${i} ${r}`:i,code:n}}function oe(a,r){const{message:i,code:n}=jw[a];return{message:r?`${i} ${r}`:i,code:n}}function mt(a,r){return Array.isArray(a)?typeof r<"u"&&a.length?a.every(r):!0:!1}function hr(a){return Object.getPrototypeOf(a)===Object.prototype&&Object.keys(a).length}function $e(a){return typeof a>"u"}function ve(a,r){return r&&$e(a)?!0:typeof a=="string"&&!!a.trim().length}function bo(a,r){return r&&$e(a)?!0:typeof a=="number"&&!isNaN(a)}function Mw(a,r){const{requiredNamespaces:i}=r,n=Object.keys(a.namespaces),o=Object.keys(i);let h=!0;return ai(o,n)?(n.forEach(d=>{const{accounts:y,methods:w,events:S}=a.namespaces[d],C=Ai(y),O=i[d];(!ai(sh(d,O),C)||!ai(O.methods,w)||!ai(O.events,S))&&(h=!1)}),h):!1}function gs(a){return ve(a,!1)&&a.includes(":")?a.split(":").length===2:!1}function kw(a){if(ve(a,!1)&&a.includes(":")){const r=a.split(":");if(r.length===3){const i=r[0]+":"+r[1];return!!r[2]&&gs(i)}}return!1}function zw(a){if(ve(a,!1))try{return typeof new URL(a)<"u"}catch{return!1}return!1}function Lw(a){var r;return(r=a==null?void 0:a.proposer)==null?void 0:r.publicKey}function Vw(a){return a==null?void 0:a.topic}function Kw(a,r){let i=null;return ve(a==null?void 0:a.publicKey,!1)||(i=R("MISSING_OR_INVALID",`${r} controller public key should be a string`)),i}function gu(a){let r=!0;return mt(a)?a.length&&(r=a.every(i=>ve(i,!1))):r=!1,r}function Hw(a,r,i){let n=null;return mt(r)&&r.length?r.forEach(o=>{n||gs(o)||(n=oe("UNSUPPORTED_CHAINS",`${i}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):gs(a)||(n=oe("UNSUPPORTED_CHAINS",`${i}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function Fw(a,r,i){let n=null;return Object.entries(a).forEach(([o,h])=>{if(n)return;const d=Hw(o,sh(o,h),`${r} ${i}`);d&&(n=d)}),n}function Gw(a,r){let i=null;return mt(a)?a.forEach(n=>{i||kw(n)||(i=oe("UNSUPPORTED_ACCOUNTS",`${r}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):i=oe("UNSUPPORTED_ACCOUNTS",`${r}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),i}function Bw(a,r){let i=null;return Object.values(a).forEach(n=>{if(i)return;const o=Gw(n==null?void 0:n.accounts,`${r} namespace`);o&&(i=o)}),i}function Ww(a,r){let i=null;return gu(a==null?void 0:a.methods)?gu(a==null?void 0:a.events)||(i=oe("UNSUPPORTED_EVENTS",`${r}, events should be an array of strings or empty array for no events`)):i=oe("UNSUPPORTED_METHODS",`${r}, methods should be an array of strings or empty array for no methods`),i}function ph(a,r){let i=null;return Object.values(a).forEach(n=>{if(i)return;const o=Ww(n,`${r}, namespace`);o&&(i=o)}),i}function Qw(a,r,i){let n=null;if(a&&hr(a)){const o=ph(a,r);o&&(n=o);const h=Fw(a,r,i);h&&(n=h)}else n=R("MISSING_OR_INVALID",`${r}, ${i} should be an object with data`);return n}function Fn(a,r){let i=null;if(a&&hr(a)){const n=ph(a,r);n&&(i=n);const o=Bw(a,r);o&&(i=o)}else i=R("MISSING_OR_INVALID",`${r}, namespaces should be an object with data`);return i}function dh(a){return ve(a.protocol,!0)}function Jw(a,r){let i=!1;return r&&!a?i=!0:a&&mt(a)&&a.length&&a.forEach(n=>{i=dh(n)}),i}function Yw(a){return typeof a=="number"}function Ue(a){return typeof a<"u"&&typeof a!==null}function Zw(a){return!(!a||typeof a!="object"||!a.code||!bo(a.code,!1)||!a.message||!ve(a.message,!1))}function Xw(a){return!($e(a)||!ve(a.method,!1))}function e0(a){return!($e(a)||$e(a.result)&&$e(a.error)||!bo(a.id,!1)||!ve(a.jsonrpc,!1))}function t0(a){return!($e(a)||!ve(a.name,!1))}function yu(a,r){return!(!gs(r)||!Aw(a).includes(r))}function i0(a,r,i){return ve(i,!1)?Tw(a,r).includes(i):!1}function r0(a,r,i){return ve(i,!1)?qw(a,r).includes(i):!1}function mu(a,r,i){let n=null;const o=s0(a),h=n0(r),d=Object.keys(o),y=Object.keys(h),w=vu(Object.keys(a)),S=vu(Object.keys(r)),C=w.filter(O=>!S.includes(O));return C.length&&(n=R("NON_CONFORMING_NAMESPACES",`${i} namespaces keys don't satisfy requiredNamespaces.
      Required: ${C.toString()}
      Received: ${Object.keys(r).toString()}`)),ai(d,y)||(n=R("NON_CONFORMING_NAMESPACES",`${i} namespaces chains don't satisfy required namespaces.
      Required: ${d.toString()}
      Approved: ${y.toString()}`)),Object.keys(r).forEach(O=>{if(!O.includes(":")||n)return;const D=Ai(r[O].accounts);D.includes(O)||(n=R("NON_CONFORMING_NAMESPACES",`${i} namespaces accounts don't satisfy namespace accounts for ${O}
        Required: ${O}
        Approved: ${D.toString()}`))}),d.forEach(O=>{n||(ai(o[O].methods,h[O].methods)?ai(o[O].events,h[O].events)||(n=R("NON_CONFORMING_NAMESPACES",`${i} namespaces events don't satisfy namespace events for ${O}`)):n=R("NON_CONFORMING_NAMESPACES",`${i} namespaces methods don't satisfy namespace methods for ${O}`))}),n}function s0(a){const r={};return Object.keys(a).forEach(i=>{var n;i.includes(":")?r[i]=a[i]:(n=a[i].chains)==null||n.forEach(o=>{r[o]={methods:a[i].methods,events:a[i].events}})}),r}function vu(a){return[...new Set(a.map(r=>r.includes(":")?r.split(":")[0]:r))]}function n0(a){const r={};return Object.keys(a).forEach(i=>{if(i.includes(":"))r[i]=a[i];else{const n=Ai(a[i].accounts);n==null||n.forEach(o=>{r[o]={accounts:a[i].accounts.filter(h=>h.includes(`${o}:`)),methods:a[i].methods,events:a[i].events}})}}),r}function o0(a,r){return bo(a,!1)&&a<=r.max&&a>=r.min}function wu(){const a=dr();return new Promise(r=>{switch(a){case Ge.browser:r(a0());break;case Ge.reactNative:r(c0());break;case Ge.node:r(u0());break;default:r(!0)}})}function a0(){return Di()&&(navigator==null?void 0:navigator.onLine)}async function c0(){if($i()&&typeof global<"u"&&global!=null&&global.NetInfo){const a=await(global==null?void 0:global.NetInfo.fetch());return a==null?void 0:a.isConnected}return!0}function u0(){return!0}function h0(a){switch(dr()){case Ge.browser:l0(a);break;case Ge.reactNative:p0(a);break}}function l0(a){!$i()&&Di()&&(window.addEventListener("online",()=>a(!0)),window.addEventListener("offline",()=>a(!1)))}function p0(a){$i()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(r=>a(r==null?void 0:r.isConnected)))}const Gn={};let cs=class{static get(r){return Gn[r]}static set(r,i){Gn[r]=i}static delete(r){delete Gn[r]}};class d0 extends xi{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}class f0 extends xi{constructor(r,i){super(),this.core=r,this.logger=i,this.records=new Map}}class g0{constructor(r,i){this.logger=r,this.core=i}}let y0=class extends xi{constructor(r,i){super(),this.relayer=r,this.logger=i}},m0=class extends xi{constructor(r){super()}},v0=class{constructor(r,i,n,o){this.core=r,this.logger=i,this.name=n}};class w0 extends xi{constructor(r,i){super(),this.relayer=r,this.logger=i}}let _0=class extends xi{constructor(r,i){super(),this.core=r,this.logger=i}},b0=class{constructor(r,i){this.projectId=r,this.logger=i}},E0=class{constructor(r,i){this.projectId=r,this.logger=i}};class I0{constructor(r){this.opts=r,this.protocol="wc",this.version=2}}let P0=class{constructor(r){this.client=r}};var S0={};function R0(a,r){if(a.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),n=0;n<i.length;n++)i[n]=255;for(var o=0;o<a.length;o++){var h=a.charAt(o),d=h.charCodeAt(0);if(i[d]!==255)throw new TypeError(h+" is ambiguous");i[d]=o}var y=a.length,w=a.charAt(0),S=Math.log(y)/Math.log(256),C=Math.log(256)/Math.log(y);function O(U){if(U instanceof Uint8Array||(ArrayBuffer.isView(U)?U=new Uint8Array(U.buffer,U.byteOffset,U.byteLength):Array.isArray(U)&&(U=Uint8Array.from(U))),!(U instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(U.length===0)return"";for(var Y=0,re=0,X=0,Se=U.length;X!==Se&&U[X]===0;)X++,Y++;for(var se=(Se-X)*C+1>>>0,ee=new Uint8Array(se);X!==Se;){for(var G=U[X],ye=0,he=se-1;(G!==0||ye<re)&&he!==-1;he--,ye++)G+=256*ee[he]>>>0,ee[he]=G%y>>>0,G=G/y>>>0;if(G!==0)throw new Error("Non-zero carry");re=ye,X++}for(var Re=se-re;Re!==se&&ee[Re]===0;)Re++;for(var Tt=w.repeat(Y);Re<se;++Re)Tt+=a.charAt(ee[Re]);return Tt}function D(U){if(typeof U!="string")throw new TypeError("Expected String");if(U.length===0)return new Uint8Array;var Y=0;if(U[Y]!==" "){for(var re=0,X=0;U[Y]===w;)re++,Y++;for(var Se=(U.length-Y)*S+1>>>0,se=new Uint8Array(Se);U[Y];){var ee=i[U.charCodeAt(Y)];if(ee===255)return;for(var G=0,ye=Se-1;(ee!==0||G<X)&&ye!==-1;ye--,G++)ee+=y*se[ye]>>>0,se[ye]=ee%256>>>0,ee=ee/256>>>0;if(ee!==0)throw new Error("Non-zero carry");X=G,Y++}if(U[Y]!==" "){for(var he=Se-X;he!==Se&&se[he]===0;)he++;for(var Re=new Uint8Array(re+(Se-he)),Tt=re;he!==Se;)Re[Tt++]=se[he++];return Re}}}function Q(U){var Y=D(U);if(Y)return Y;throw new Error(`Non-${r} character`)}return{encode:O,decodeUnsafe:D,decode:Q}}var O0=R0,N0=O0;const fh=a=>{if(a instanceof Uint8Array&&a.constructor.name==="Uint8Array")return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw new Error("Unknown type, must be binary type")},C0=a=>new TextEncoder().encode(a),x0=a=>new TextDecoder().decode(a);class $0{constructor(r,i,n){this.name=r,this.prefix=i,this.baseEncode=n}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class D0{constructor(r,i,n){if(this.name=r,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=n}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return gh(this,r)}}class A0{constructor(r){this.decoders=r}or(r){return gh(this,r)}decode(r){const i=r[0],n=this.decoders[i];if(n)return n.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const gh=(a,r)=>new A0({...a.decoders||{[a.prefix]:a},...r.decoders||{[r.prefix]:r}});class T0{constructor(r,i,n,o){this.name=r,this.prefix=i,this.baseEncode=n,this.baseDecode=o,this.encoder=new $0(r,i,n),this.decoder=new D0(r,i,o)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const _s=({name:a,prefix:r,encode:i,decode:n})=>new T0(a,r,i,n),fr=({prefix:a,name:r,alphabet:i})=>{const{encode:n,decode:o}=N0(i,r);return _s({prefix:a,name:r,encode:n,decode:h=>fh(o(h))})},q0=(a,r,i,n)=>{const o={};for(let C=0;C<r.length;++C)o[r[C]]=C;let h=a.length;for(;a[h-1]==="=";)--h;const d=new Uint8Array(h*i/8|0);let y=0,w=0,S=0;for(let C=0;C<h;++C){const O=o[a[C]];if(O===void 0)throw new SyntaxError(`Non-${n} character`);w=w<<i|O,y+=i,y>=8&&(y-=8,d[S++]=255&w>>y)}if(y>=i||255&w<<8-y)throw new SyntaxError("Unexpected end of data");return d},j0=(a,r,i)=>{const n=r[r.length-1]==="=",o=(1<<i)-1;let h="",d=0,y=0;for(let w=0;w<a.length;++w)for(y=y<<8|a[w],d+=8;d>i;)d-=i,h+=r[o&y>>d];if(d&&(h+=r[o&y<<i-d]),n)for(;h.length*i&7;)h+="=";return h},be=({name:a,prefix:r,bitsPerChar:i,alphabet:n})=>_s({prefix:r,name:a,encode(o){return j0(o,n,i)},decode(o){return q0(o,n,i,a)}}),U0=_s({prefix:"\0",name:"identity",encode:a=>x0(a),decode:a=>C0(a)});var M0=Object.freeze({__proto__:null,identity:U0});const k0=be({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var z0=Object.freeze({__proto__:null,base2:k0});const L0=be({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var V0=Object.freeze({__proto__:null,base8:L0});const K0=fr({prefix:"9",name:"base10",alphabet:"0123456789"});var H0=Object.freeze({__proto__:null,base10:K0});const F0=be({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),G0=be({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var B0=Object.freeze({__proto__:null,base16:F0,base16upper:G0});const W0=be({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Q0=be({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),J0=be({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Y0=be({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Z0=be({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),X0=be({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),e_=be({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),t_=be({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),i_=be({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var r_=Object.freeze({__proto__:null,base32:W0,base32upper:Q0,base32pad:J0,base32padupper:Y0,base32hex:Z0,base32hexupper:X0,base32hexpad:e_,base32hexpadupper:t_,base32z:i_});const s_=fr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),n_=fr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var o_=Object.freeze({__proto__:null,base36:s_,base36upper:n_});const a_=fr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),c_=fr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var u_=Object.freeze({__proto__:null,base58btc:a_,base58flickr:c_});const h_=be({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),l_=be({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),p_=be({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),d_=be({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var f_=Object.freeze({__proto__:null,base64:h_,base64pad:l_,base64url:p_,base64urlpad:d_});const yh=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),g_=yh.reduce((a,r,i)=>(a[i]=r,a),[]),y_=yh.reduce((a,r,i)=>(a[r.codePointAt(0)]=i,a),[]);function m_(a){return a.reduce((r,i)=>(r+=g_[i],r),"")}function v_(a){const r=[];for(const i of a){const n=y_[i.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${i}`);r.push(n)}return new Uint8Array(r)}const w_=_s({prefix:"🚀",name:"base256emoji",encode:m_,decode:v_});var __=Object.freeze({__proto__:null,base256emoji:w_}),b_=mh,_u=128,E_=127,I_=~E_,P_=Math.pow(2,31);function mh(a,r,i){r=r||[],i=i||0;for(var n=i;a>=P_;)r[i++]=a&255|_u,a/=128;for(;a&I_;)r[i++]=a&255|_u,a>>>=7;return r[i]=a|0,mh.bytes=i-n+1,r}var S_=oo,R_=128,bu=127;function oo(a,n){var i=0,n=n||0,o=0,h=n,d,y=a.length;do{if(h>=y)throw oo.bytes=0,new RangeError("Could not decode varint");d=a[h++],i+=o<28?(d&bu)<<o:(d&bu)*Math.pow(2,o),o+=7}while(d>=R_);return oo.bytes=h-n,i}var O_=Math.pow(2,7),N_=Math.pow(2,14),C_=Math.pow(2,21),x_=Math.pow(2,28),$_=Math.pow(2,35),D_=Math.pow(2,42),A_=Math.pow(2,49),T_=Math.pow(2,56),q_=Math.pow(2,63),j_=function(a){return a<O_?1:a<N_?2:a<C_?3:a<x_?4:a<$_?5:a<D_?6:a<A_?7:a<T_?8:a<q_?9:10},U_={encode:b_,decode:S_,encodingLength:j_},vh=U_;const Eu=(a,r,i=0)=>(vh.encode(a,r,i),r),Iu=a=>vh.encodingLength(a),ao=(a,r)=>{const i=r.byteLength,n=Iu(a),o=n+Iu(i),h=new Uint8Array(o+i);return Eu(a,h,0),Eu(i,h,n),h.set(r,o),new M_(a,i,r,h)};class M_{constructor(r,i,n,o){this.code=r,this.size=i,this.digest=n,this.bytes=o}}const wh=({name:a,code:r,encode:i})=>new k_(a,r,i);class k_{constructor(r,i,n){this.name=r,this.code=i,this.encode=n}digest(r){if(r instanceof Uint8Array){const i=this.encode(r);return i instanceof Uint8Array?ao(this.code,i):i.then(n=>ao(this.code,n))}else throw Error("Unknown type, must be binary type")}}const _h=a=>async r=>new Uint8Array(await crypto.subtle.digest(a,r)),z_=wh({name:"sha2-256",code:18,encode:_h("SHA-256")}),L_=wh({name:"sha2-512",code:19,encode:_h("SHA-512")});var V_=Object.freeze({__proto__:null,sha256:z_,sha512:L_});const bh=0,K_="identity",Eh=fh,H_=a=>ao(bh,Eh(a)),F_={code:bh,name:K_,encode:Eh,digest:H_};var G_=Object.freeze({__proto__:null,identity:F_});new TextEncoder,new TextDecoder;const Pu={...M0,...z0,...V0,...H0,...B0,...r_,...o_,...u_,...f_,...__};({...V_,...G_});function Ih(a){return globalThis.Buffer!=null?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function B_(a=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ih(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function Ph(a,r,i,n){return{name:a,prefix:r,encoder:{name:a,prefix:r,encode:i},decoder:{decode:n}}}const Su=Ph("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),Bn=Ph("ascii","a",a=>{let r="a";for(let i=0;i<a.length;i++)r+=String.fromCharCode(a[i]);return r},a=>{a=a.substring(1);const r=B_(a.length);for(let i=0;i<a.length;i++)r[i]=a.charCodeAt(i);return r}),W_={utf8:Su,"utf-8":Su,hex:Pu.base16,latin1:Bn,ascii:Bn,binary:Bn,...Pu};function Q_(a,r="utf8"){const i=W_[r];if(!i)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ih(globalThis.Buffer.from(a,"utf-8")):i.decoder.decode(`${i.prefix}${a}`)}const Sh="wc",J_=2,Eo="core",Bt=`${Sh}@2:${Eo}:`,Y_={name:Eo,logger:"error"},Z_={database:":memory:"},X_="crypto",Ru="client_ed25519_seed",eb=A.ONE_DAY,tb="keychain",ib="0.3",rb="messages",sb="0.3",nb=A.SIX_HOURS,ob="publisher",Rh="irn",ab="error",Oh="wss://relay.walletconnect.com",Ou="wss://relay.walletconnect.org",cb="relayer",Pe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},ub="_subscription",Nt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},hb=A.ONE_SECOND,lb="2.11.2",pb=1e4,db="0.3",fb="WALLETCONNECT_CLIENT_ID",ht={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},gb="subscription",yb="0.3",mb=A.FIVE_SECONDS*1e3,vb="pairing",wb="0.3",ir={wc_pairingDelete:{req:{ttl:A.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:A.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:A.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:A.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:A.ONE_DAY,prompt:!1,tag:0},res:{ttl:A.ONE_DAY,prompt:!1,tag:0}}},or={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},yt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},_b="history",bb="0.3",Eb="expirer",it={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Ib="0.3",Wn="verify-api",Ni="https://verify.walletconnect.com",co="https://verify.walletconnect.org",Pb=[Ni,co],Sb="echo",Rb="https://echo.walletconnect.com";class Ob{constructor(r,i){this.core=r,this.logger=i,this.keychain=new Map,this.name=tb,this.version=ib,this.initialized=!1,this.storagePrefix=Bt,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:h}=R("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(h)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=r,this.logger=Me(i,this.name)}get context(){return Be(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,ch(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?uh(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=R("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Nb{constructor(r,i,n){this.core=r,this.logger=i,this.name=X_,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),h=ou(o);return Mv(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=Yv();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const h=await this.getClientSeed(),d=ou(h),y=so();return await kv(y,o,eb,d)},this.generateSharedKey=(o,h,d)=>{this.isInitialized();const y=this.getPrivateKey(o),w=Zv(y,h);return this.setSymKey(w,d)},this.setSymKey=async(o,h)=>{this.isInitialized();const d=h||Xv(o);return await this.keychain.set(d,o),d},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,h,d)=>{this.isInitialized();const y=ah(d),w=zv(h);if(cu(y)){const D=y.senderPublicKey,Q=y.receiverPublicKey;o=await this.generateSharedKey(D,Q)}const S=this.getSymKey(o),{type:C,senderPublicKey:O}=y;return tw({type:C,symKey:S,message:w,senderPublicKey:O})},this.decode=async(o,h,d)=>{this.isInitialized();const y=sw(h,d);if(cu(y)){const w=y.receiverPublicKey,S=y.senderPublicKey;o=await this.generateSharedKey(w,S)}try{const w=this.getSymKey(o),S=iw({symKey:w,encoded:h});return Lv(S)}catch(w){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=o=>{const h=fs(o);return pr(h.type)},this.getPayloadSenderPublicKey=o=>{const h=fs(o);return h.senderPublicKey?rt(h.senderPublicKey,De):void 0},this.core=r,this.logger=Me(i,this.name),this.keychain=n||new Ob(this.core,this.logger)}get context(){return Be(this.logger)}async setPrivateKey(r,i){return await this.keychain.set(r,i),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(Ru)}catch{r=so(),await this.keychain.set(Ru,r)}return Q_(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=R("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Cb extends g0{constructor(r,i){super(r,i),this.logger=r,this.core=i,this.messages=new Map,this.name=rb,this.version=sb,this.initialized=!1,this.storagePrefix=Bt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const h=Ci(o);let d=this.messages.get(n);return typeof d>"u"&&(d={}),typeof d[h]<"u"||(d[h]=o,this.messages.set(n,d),await this.persist()),h},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const h=this.get(n),d=Ci(o);return typeof h[d]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Me(r,this.name),this.core=i}get context(){return Be(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,ch(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?uh(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=R("NOT_INITIALIZED",this.name);throw new Error(r)}}}class xb extends y0{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.events=new Qt.EventEmitter,this.name=ob,this.queue=new Map,this.publishTimeout=A.toMiliseconds(A.TEN_SECONDS*2),this.needsTransportRestart=!1,this.publish=async(n,o,h)=>{var d;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:h}});try{const y=(h==null?void 0:h.ttl)||nb,w=no(h),S=(h==null?void 0:h.prompt)||!1,C=(h==null?void 0:h.tag)||0,O=(h==null?void 0:h.id)||Hv().toString(),D={topic:n,message:o,opts:{ttl:y,relay:w,prompt:S,tag:C,id:O}},Q=setTimeout(()=>this.queue.set(O,D),this.publishTimeout);try{await await ur(this.rpcPublish(n,o,y,w,S,C,O),this.publishTimeout,`Failed to publish payload, please try again. id:${O} tag:${C}`),this.removeRequestFromQueue(O),this.relayer.events.emit(Pe.publish,D)}catch(U){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(d=h==null?void 0:h.internal)!=null&&d.throwOnFailedPublish)throw this.removeRequestFromQueue(O),U;return}finally{clearTimeout(Q)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:h}})}catch(y){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(y),y}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=r,this.logger=Me(i,this.name),this.registerEventListeners()}get context(){return Be(this.logger)}rpcPublish(r,i,n,o,h,d,y){var w,S,C,O;const D={method:ps(o.protocol).publish,params:{topic:r,message:i,ttl:n,prompt:h,tag:d},id:y};return $e((w=D.params)==null?void 0:w.prompt)&&((S=D.params)==null||delete S.prompt),$e((C=D.params)==null?void 0:C.tag)&&((O=D.params)==null||delete O.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:D}),this.relayer.request(D)}removeRequestFromQueue(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:i,message:n,opts:o}=r;await this.publish(i,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(lr.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Pe.connection_stalled);return}this.checkQueue()}),this.relayer.on(Pe.message_ack,r=>{this.removeRequestFromQueue(r.id.toString())})}}class $b{constructor(){this.map=new Map,this.set=(r,i)=>{const n=this.get(r);this.exists(r,i)||this.map.set(r,[...n,i])},this.get=r=>this.map.get(r)||[],this.exists=(r,i)=>this.get(r).includes(i),this.delete=(r,i)=>{if(typeof i>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const n=this.get(r);if(!this.exists(r,i))return;const o=n.filter(h=>h!==i);if(!o.length){this.map.delete(r);return}this.map.set(r,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Db=Object.defineProperty,Ab=Object.defineProperties,Tb=Object.getOwnPropertyDescriptors,Nu=Object.getOwnPropertySymbols,qb=Object.prototype.hasOwnProperty,jb=Object.prototype.propertyIsEnumerable,Cu=(a,r,i)=>r in a?Db(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i,rr=(a,r)=>{for(var i in r||(r={}))qb.call(r,i)&&Cu(a,i,r[i]);if(Nu)for(var i of Nu(r))jb.call(r,i)&&Cu(a,i,r[i]);return a},Qn=(a,r)=>Ab(a,Tb(r));class Ub extends w0{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.subscriptions=new Map,this.topicMap=new $b,this.events=new Qt.EventEmitter,this.name=gb,this.version=yb,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Bt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const h=no(o),d={topic:n,relay:h};this.pending.set(n,d);const y=await this.rpcSubscribe(n,h);return this.onSubscribe(y,d),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}}),y}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>{if(this.topics.includes(n))return!0;const o=`${this.pendingSubscriptionWatchLabel}_${n}`;return await new Promise((h,d)=>{const y=new A.Watch;y.start(o);const w=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(w),y.stop(o),h(!0)),y.elapsed(o)>=mb&&(clearInterval(w),y.stop(o),d(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=Me(i,this.name),this.clientId=""}get context(){return Be(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,i){let n=!1;try{n=this.getSubscription(r).topic===i}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,i){const n=this.topicMap.get(r);await Promise.all(n.map(async o=>await this.unsubscribeById(r,o,i)))}async unsubscribeById(r,i,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}});try{const o=no(n);await this.rpcUnsubscribe(r,i,o);const h=oe("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,i,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(r,i){const n={method:ps(i.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await ur(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Pe.connection_stalled)}return Ci(r+this.clientId)}async rpcBatchSubscribe(r){if(!r.length)return;const i=r[0].relay,n={method:ps(i.protocol).batchSubscribe,params:{topics:r.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await ur(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Pe.connection_stalled)}}rpcUnsubscribe(r,i,n){const o={method:ps(n.protocol).unsubscribe,params:{topic:r,id:i}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(r,i){this.setSubscription(r,Qn(rr({},i),{id:r})),this.pending.delete(i.topic)}onBatchSubscribe(r){r.length&&r.forEach(i=>{this.setSubscription(i.id,rr({},i)),this.pending.delete(i.topic)})}async onUnsubscribe(r,i,n){this.events.removeAllListeners(i),this.hasSubscription(i,r)&&this.deleteSubscription(i,n),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,i){this.subscriptions.has(r)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:i}),this.addSubscription(r,i))}addSubscription(r,i){this.subscriptions.set(r,rr({},i)),this.topicMap.set(i.topic,r),this.events.emit(ht.created,i)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const i=this.subscriptions.get(r);if(!i){const{message:n}=R("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}deleteSubscription(r,i){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:i});const n=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(n.topic,r),this.events.emit(ht.deleted,Qn(rr({},n),{reason:i}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(ht.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(ht.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:i}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const i=await this.rpcBatchSubscribe(r);mt(i)&&this.onBatchSubscribe(i.map((n,o)=>Qn(rr({},r[o]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}registerEventListeners(){this.relayer.core.heartbeat.on(lr.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Pe.connect,async()=>{await this.onConnect()}),this.relayer.on(Pe.disconnect,()=>{this.onDisconnect()}),this.events.on(ht.created,async r=>{const i=ht.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(ht.deleted,async r=>{const i=ht.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=R("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){this.restartInProgress&&await new Promise(r=>{const i=setInterval(()=>{this.restartInProgress||(clearInterval(i),r())},this.pollingInterval)})}}var Mb=Object.defineProperty,xu=Object.getOwnPropertySymbols,kb=Object.prototype.hasOwnProperty,zb=Object.prototype.propertyIsEnumerable,$u=(a,r,i)=>r in a?Mb(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i,Lb=(a,r)=>{for(var i in r||(r={}))kb.call(r,i)&&$u(a,i,r[i]);if(xu)for(var i of xu(r))zb.call(r,i)&&$u(a,i,r[i]);return a};class Vb extends m0{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new Qt.EventEmitter,this.name=cb,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.request=async i=>{this.logger.debug("Publishing Request Payload");const n=i.id;try{await this.toEstablishConnection();const o=this.provider.request(i);return this.requestsInFlight.set(n,{promise:o,request:i}),await o}catch(o){throw this.logger.debug("Failed to Publish Request"),this.logger.error(o),o}finally{this.requestsInFlight.delete(n)}},this.onPayloadHandler=i=>{this.onProviderPayload(i)},this.onConnectHandler=()=>{this.events.emit(Pe.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=i=>{this.logger.error(i),this.events.emit(Pe.error,i),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(Nt.payload,this.onPayloadHandler),this.provider.on(Nt.connect,this.onConnectHandler),this.provider.on(Nt.disconnect,this.onDisconnectHandler),this.provider.on(Nt.error,this.onProviderErrorHandler)},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?Me(r.logger,this.name):ms(vs({level:r.logger||ab})),this.messages=new Cb(this.logger,r.core),this.subscriber=new Ub(this,this.logger),this.publisher=new xb(this,this.logger),this.relayUrl=(r==null?void 0:r.relayUrl)||Oh,this.projectId=r.projectId,this.bundleId=hw(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Ou}...`),await this.restartTransport(Ou)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},pb)}get context(){return Be(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(r,i,n){this.isInitialized(),await this.publisher.publish(r,i,n),await this.recordMessageEvent({topic:r,message:i,publishedAt:Date.now()})}async subscribe(r,i){var n;this.isInitialized();let o=((n=this.subscriber.topicMap.get(r))==null?void 0:n[0])||"";if(o)return o;let h;const d=y=>{y.topic===r&&(this.subscriber.off(ht.created,d),h())};return await Promise.all([new Promise(y=>{h=y,this.subscriber.on(ht.created,d)}),new Promise(async y=>{o=await this.subscriber.subscribe(r,i),y()})]),o}async unsubscribe(r,i){this.isInitialized(),await this.subscriber.unsubscribe(r,i)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async transportClose(){this.requestsInFlight.size>0&&(this.logger.debug("Waiting for all in-flight requests to finish before closing transport..."),this.requestsInFlight.forEach(async r=>{await r.promise})),this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await ur(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(r){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){r&&r!==this.relayUrl&&(this.relayUrl=r,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(i=>{if(!this.initialized)return i();this.subscriber.once(ht.resubscribed,()=>{i()})}),new Promise(async(i,n)=>{try{await ur(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){n(o);return}i()})])}catch(i){this.logger.error(i);const n=i;if(!this.isConnectionStalled(n.message))throw i;this.provider.events.emit(Nt.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(r){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=r||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await wu())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(r){return this.staleConnectionErrors.some(i=>r.includes(i))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Dt(new Vv(yw({sdkVersion:lb,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:i,message:n}=r;await this.messages.set(i,n)}async shouldIgnoreMessageEvent(r){const{topic:i,message:n}=r;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(i))return this.logger.debug(`Ignoring message for non-subscribed topic ${i}`),!0;const o=this.messages.has(i,n);return o&&this.logger.debug(`Ignoring duplicate message: ${n}`),o}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),fo(r)){if(!r.method.endsWith(ub))return;const i=r.params,{topic:n,message:o,publishedAt:h}=i.data,d={topic:n,message:o,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Lb({type:"event",event:i.id},d)),this.events.emit(i.id,d),await this.acknowledgePayload(r),await this.onMessageEvent(d)}else go(r)&&this.events.emit(Pe.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(Pe.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const i=ws(r.id,!0);await this.provider.connection.send(i)}unregisterProviderListeners(){this.provider.off(Nt.payload,this.onPayloadHandler),this.provider.off(Nt.connect,this.onConnectHandler),this.provider.off(Nt.disconnect,this.onDisconnectHandler),this.provider.off(Nt.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Pe.connection_stalled,()=>{this.restartTransport().catch(i=>this.logger.error(i))});let r=await wu();h0(async i=>{this.initialized&&r!==i&&(r=i,i?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Pe.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(r=>this.logger.error(r))},A.toMiliseconds(hb)))}isInitialized(){if(!this.initialized){const{message:r}=R("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(r=>{const i=setInterval(()=>{this.connected&&(clearInterval(i),r())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Kb=Object.defineProperty,Du=Object.getOwnPropertySymbols,Hb=Object.prototype.hasOwnProperty,Fb=Object.prototype.propertyIsEnumerable,Au=(a,r,i)=>r in a?Kb(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i,Tu=(a,r)=>{for(var i in r||(r={}))Hb.call(r,i)&&Au(a,i,r[i]);if(Du)for(var i of Du(r))Fb.call(r,i)&&Au(a,i,r[i]);return a};class bs extends v0{constructor(r,i,n,o=Bt,h=void 0){super(r,i,n,o),this.core=r,this.logger=i,this.name=n,this.map=new Map,this.version=db,this.cached=[],this.initialized=!1,this.storagePrefix=Bt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(d=>{this.getKey&&d!==null&&!$e(d)?this.map.set(this.getKey(d),d):Lw(d)?this.map.set(d.id,d):Vw(d)&&this.map.set(d.topic,d)}),this.cached=[],this.initialized=!0)},this.set=async(d,y)=>{this.isInitialized(),this.map.has(d)?await this.update(d,y):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:d,value:y}),this.map.set(d,y),await this.persist())},this.get=d=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:d}),this.getData(d)),this.getAll=d=>(this.isInitialized(),d?this.values.filter(y=>Object.keys(d).every(w=>jv(y[w],d[w]))):this.values),this.update=async(d,y)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:d,update:y});const w=Tu(Tu({},this.getData(d)),y);this.map.set(d,w),await this.persist()},this.delete=async(d,y)=>{this.isInitialized(),this.map.has(d)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:d,reason:y}),this.map.delete(d),await this.persist())},this.logger=Me(i,this.name),this.storagePrefix=o,this.getKey=h}get context(){return Be(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const i=this.map.get(r);if(!i){const{message:n}=R("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:i}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=R("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Gb{constructor(r,i){this.core=r,this.logger=i,this.name=vb,this.version=wb,this.events=new yo,this.initialized=!1,this.storagePrefix=Bt,this.ignoredPayloadTypes=[ci],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=so(),o=await this.core.crypto.setSymKey(n),h=Fe(A.FIVE_MINUTES),d={protocol:Rh},y={topic:o,expiry:h,relay:d,active:!1},w=Dw({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:n,relay:d,expiryTimestamp:h});return await this.pairings.set(o,y),await this.core.relayer.subscribe(o),this.core.expirer.set(o,h),{topic:o,uri:w}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:h,relay:d,expiryTimestamp:y}=fu(n.uri);let w;if(this.pairings.keys.includes(o)&&(w=this.pairings.get(o),w.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);const S=y||Fe(A.FIVE_MINUTES),C={topic:o,relay:d,expiry:S,active:!1};return await this.pairings.set(o,C),this.core.expirer.set(o,S),n.activatePairing&&await this.activate({topic:o}),this.events.emit(or.create,C),this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(h,o),await this.core.relayer.subscribe(o,{relay:d})),C},this.activate=async({topic:n})=>{this.isInitialized();const o=Fe(A.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const h=await this.sendRequest(o,"wc_pairingPing",{}),{done:d,resolve:y,reject:w}=Oi();this.events.once(de("pairing_ping",h),({error:S})=>{S?w(S):y()}),await d()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",oe("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,h)=>{const d=cr(o,h),y=await this.core.crypto.encode(n,d),w=ir[o].req;return this.core.history.set(n,d),this.core.relayer.publish(n,y,w),d.id},this.sendResult=async(n,o,h)=>{const d=ws(n,h),y=await this.core.crypto.encode(o,d),w=await this.core.history.get(o,n),S=ir[w.request.method].res;await this.core.relayer.publish(o,y,S),await this.core.history.resolve(d)},this.sendError=async(n,o,h)=>{const d=rh(n,h),y=await this.core.crypto.encode(o,d),w=await this.core.history.get(o,n),S=ir[w.request.method]?ir[w.request.method].res:ir.unregistered_method.res;await this.core.relayer.publish(o,y,S),await this.core.history.resolve(d)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,oe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>Gt(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:h}=n;switch(h.method){case"wc_pairingPing":return this.onPairingPingRequest(o,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,h);default:return this.onUnknownRpcMethodRequest(o,h)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:h}=n,d=(await this.core.history.get(o,h.id)).request.method;switch(d){case"wc_pairingPing":return this.onPairingPingResponse(o,h);default:return this.onUnknownRpcMethodResponse(d)}},this.onPairingPingRequest=async(n,o)=>{const{id:h}=o;try{this.isValidPing({topic:n}),await this.sendResult(h,n,!0),this.events.emit(or.ping,{id:h,topic:n})}catch(d){await this.sendError(h,n,d),this.logger.error(d)}},this.onPairingPingResponse=(n,o)=>{const{id:h}=o;setTimeout(()=>{Ft(o)?this.events.emit(de("pairing_ping",h),{}):$t(o)&&this.events.emit(de("pairing_ping",h),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:h}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(or.delete,{id:h,topic:n})}catch(d){await this.sendError(h,n,d),this.logger.error(d)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:h,method:d}=o;try{if(this.registeredMethods.includes(d))return;const y=oe("WC_METHOD_UNSUPPORTED",d);await this.sendError(h,n,y),this.logger.error(y)}catch(y){await this.sendError(h,n,y),this.logger.error(y)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(oe("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{var o;if(!Ue(n)){const{message:d}=R("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(d)}if(!zw(n.uri)){const{message:d}=R("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(d)}const h=fu(n.uri);if(!((o=h==null?void 0:h.relay)!=null&&o.protocol)){const{message:d}=R("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(d)}if(!(h!=null&&h.symKey)){const{message:d}=R("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(d)}if(h!=null&&h.expiryTimestamp&&A.toMiliseconds(h==null?void 0:h.expiryTimestamp)<Date.now()){const{message:d}=R("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(d)}},this.isValidPing=async n=>{if(!Ue(n)){const{message:h}=R("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(h)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!Ue(n)){const{message:h}=R("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(h)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!ve(n,!1)){const{message:o}=R("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=R("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(Gt(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=R("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=r,this.logger=Me(i,this.name),this.pairings=new bs(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Be(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=R("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(Pe.message,async r=>{const{topic:i,message:n}=r;if(!this.pairings.keys.includes(i)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(i,n);try{fo(o)?(this.core.history.set(i,o),this.onRelayEventRequest({topic:i,payload:o})):go(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:i,payload:o}),this.core.history.delete(i,o.id))}catch(h){this.logger.error(h)}})}registerExpirerEvents(){this.core.expirer.on(it.expired,async r=>{const{topic:i}=lh(r.target);i&&this.pairings.keys.includes(i)&&(await this.deletePairing(i,!0),this.events.emit(or.expire,{topic:i}))})}}class Bb extends f0{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.records=new Map,this.events=new Qt.EventEmitter,this.name=_b,this.version=bb,this.cached=[],this.initialized=!1,this.storagePrefix=Bt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:h}),this.records.has(o.id))return;const d={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:h,expiry:Fe(A.THIRTY_DAYS)};this.records.set(d.id,d),this.events.emit(yt.created,d)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=$t(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.events.emit(yt.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(h=>{if(h.topic===n){if(typeof o<"u"&&h.id!==o)return;this.records.delete(h.id),this.events.emit(yt.deleted,h)}})},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Me(i,this.name)}get context(){return Be(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(i=>{if(typeof i.response<"u")return;const n={topic:i.topic,request:cr(i.request.method,i.request.params,i.id),chainId:i.chainId};return r.push(n)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const i=this.records.get(r);if(!i){const{message:n}=R("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(yt.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:i}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(yt.created,r=>{const i=yt.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(yt.updated,r=>{const i=yt.updated;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(yt.deleted,r=>{const i=yt.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.core.heartbeat.on(lr.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(r=>{A.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.delete(r.topic,r.id))})}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=R("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Wb extends _0{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.expirations=new Map,this.events=new Qt.EventEmitter,this.name=Eb,this.version=Ib,this.cached=[],this.initialized=!1,this.storagePrefix=Bt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const h=this.formatTarget(n),d={target:h,expiry:o};this.expirations.set(h,d),this.checkExpiry(h,d),this.events.emit(it.created,{target:h,expiration:d})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),h=this.getExpiration(o);this.expirations.delete(o),this.events.emit(it.deleted,{target:o,expiration:h})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Me(i,this.name)}get context(){return Be(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return mw(r);if(typeof r=="number")return vw(r);const{message:i}=R("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(i)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(it.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:i}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const i=this.expirations.get(r);if(!i){const{message:n}=R("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}checkExpiry(r,i){const{expiry:n}=i;A.toMiliseconds(n)-Date.now()<=0&&this.expire(r,i)}expire(r,i){this.expirations.delete(r),this.events.emit(it.expired,{target:r,expiration:i})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,i)=>this.checkExpiry(i,r))}registerEventListeners(){this.core.heartbeat.on(lr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(it.created,r=>{const i=it.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(it.expired,r=>{const i=it.expired;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(it.deleted,r=>{const i=it.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=R("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Qb extends b0{constructor(r,i){super(r,i),this.projectId=r,this.logger=i,this.name=Wn,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||$i()||!Di())return;const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);this.verifyUrl!==o&&this.removeIframe(),this.verifyUrl=o;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h)}if(!this.initialized){this.removeIframe(),this.verifyUrl=co;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);let h;try{h=await this.fetchAttestation(n.attestationId,o)}catch(d){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${o}`),this.logger.info(d),h=await this.fetchAttestation(n.attestationId,co)}return h},this.fetchAttestation=async(n,o)=>{this.logger.info(`resolving attestation: ${n} from url: ${o}`);const h=this.startAbortTimer(A.ONE_SECOND*2),d=await fetch(`${o}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(h),d.status===200?await d.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const o=h=>{h.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),n())};await Promise.race([new Promise(h=>{if(document.getElementById(Wn))return h();window.addEventListener("message",o);const d=document.createElement("iframe");d.id=Wn,d.src=`${this.verifyUrl}/${this.projectId}`,d.style.display="none",document.body.append(d),this.iframe=d,n=h}),new Promise((h,d)=>setTimeout(()=>{window.removeEventListener("message",o),d("verify iframe load timeout")},A.toMiliseconds(A.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=n=>{let o=n||Ni;return Pb.includes(o)||(this.logger.info(`verify url: ${o}, not included in trusted list, assigning default: ${Ni}`),o=Ni),o},this.logger=Me(i,this.name),this.verifyUrl=Ni,this.abortController=new AbortController,this.isDevEnv=wo()&&S0.IS_VITEST}get context(){return Be(this.logger)}startAbortTimer(r){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),A.toMiliseconds(r))}}class Jb extends E0{constructor(r,i){super(r,i),this.projectId=r,this.logger=i,this.context=Sb,this.registerDeviceToken=async n=>{const{clientId:o,token:h,notificationType:d,enableEncrypted:y=!1}=n,w=`${Rb}/${this.projectId}/clients`;await Kv(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:o,type:d,token:h,always_raw:y})})},this.logger=Me(i,this.context)}}var Yb=Object.defineProperty,qu=Object.getOwnPropertySymbols,Zb=Object.prototype.hasOwnProperty,Xb=Object.prototype.propertyIsEnumerable,ju=(a,r,i)=>r in a?Yb(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i,Uu=(a,r)=>{for(var i in r||(r={}))Zb.call(r,i)&&ju(a,i,r[i]);if(qu)for(var i of qu(r))Xb.call(r,i)&&ju(a,i,r[i]);return a};class Io extends d0{constructor(r){super(r),this.protocol=Sh,this.version=J_,this.name=Eo,this.events=new Qt.EventEmitter,this.initialized=!1,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.projectId=r==null?void 0:r.projectId,this.relayUrl=(r==null?void 0:r.relayUrl)||Oh,this.customStoragePrefix=r!=null&&r.customStoragePrefix?`:${r.customStoragePrefix}`:"";const i=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:ms(vs({level:(r==null?void 0:r.logger)||Y_.logger}));this.logger=Me(i,this.name),this.heartbeat=new lr.HeartBeat,this.crypto=new Nb(this,this.logger,r==null?void 0:r.keychain),this.history=new Bb(this,this.logger),this.expirer=new Wb(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new Uv(Uu(Uu({},Z_),r==null?void 0:r.storageOptions)),this.relayer=new Vb({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Gb(this,this.logger),this.verify=new Qb(this.projectId||"",this.logger),this.echoClient=new Jb(this.projectId||"",this.logger)}static async init(r){const i=new Io(r);await i.initialize();const n=await i.crypto.getClientId();return await i.storage.setItem(fb,n),i}get context(){return Be(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}}const e1=Io,Nh="wc",Ch=2,xh="client",Po=`${Nh}@${Ch}:${xh}:`,Jn={name:xh,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Mu="WALLETCONNECT_DEEPLINK_CHOICE",t1="proposal",$h="Proposal expired",i1="session",us=A.SEVEN_DAYS,r1="engine",Ct={wc_sessionPropose:{req:{ttl:A.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:A.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:A.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:A.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:A.ONE_DAY,prompt:!1,tag:1104},res:{ttl:A.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:A.ONE_DAY,prompt:!1,tag:1106},res:{ttl:A.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:A.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:A.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:A.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:A.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:A.ONE_DAY,prompt:!1,tag:1112},res:{ttl:A.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:A.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:A.THIRTY_SECONDS,prompt:!1,tag:1115}}},Yn={min:A.FIVE_MINUTES,max:A.SEVEN_DAYS},xt={idle:"IDLE",active:"ACTIVE"},s1="request",n1=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var o1=Object.defineProperty,a1=Object.defineProperties,c1=Object.getOwnPropertyDescriptors,ku=Object.getOwnPropertySymbols,u1=Object.prototype.hasOwnProperty,h1=Object.prototype.propertyIsEnumerable,zu=(a,r,i)=>r in a?o1(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i,xe=(a,r)=>{for(var i in r||(r={}))u1.call(r,i)&&zu(a,i,r[i]);if(ku)for(var i of ku(r))h1.call(r,i)&&zu(a,i,r[i]);return a},Ri=(a,r)=>a1(a,c1(r));class l1 extends P0{constructor(r){super(r),this.name=r1,this.events=new yo,this.initialized=!1,this.ignoredPayloadTypes=[ci],this.requestQueue={state:xt.idle,queue:[]},this.sessionRequestQueue={state:xt.idle,queue:[]},this.requestQueueDelay=A.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Ct)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},A.toMiliseconds(this.requestQueueDelay)))},this.connect=async i=>{await this.isInitialized();const n=Ri(xe({},i),{requiredNamespaces:i.requiredNamespaces||{},optionalNamespaces:i.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:h,optionalNamespaces:d,sessionProperties:y,relays:w}=n;let S=o,C,O=!1;if(S&&(O=this.client.core.pairing.pairings.get(S).active),!S||!O){const{topic:ee,uri:G}=await this.client.core.pairing.create();S=ee,C=G}const D=await this.client.core.crypto.generateKeyPair(),Q=Ct.wc_sessionPropose.req.ttl||A.FIVE_MINUTES,U=Fe(Q),Y=xe({requiredNamespaces:h,optionalNamespaces:d,relays:w??[{protocol:Rh}],proposer:{publicKey:D,metadata:this.client.metadata},expiryTimestamp:U},y&&{sessionProperties:y}),{reject:re,resolve:X,done:Se}=Oi(Q,$h);if(this.events.once(de("session_connect"),async({error:ee,session:G})=>{if(ee)re(ee);else if(G){G.self.publicKey=D;const ye=Ri(xe({},G),{requiredNamespaces:Y.requiredNamespaces,optionalNamespaces:Y.optionalNamespaces});await this.client.session.set(G.topic,ye),await this.setExpiry(G.topic,G.expiry),S&&await this.client.core.pairing.updateMetadata({topic:S,metadata:G.peer.metadata}),X(ye)}}),!S){const{message:ee}=R("NO_MATCHING_KEY",`connect() pairing topic: ${S}`);throw new Error(ee)}const se=await this.sendRequest({topic:S,method:"wc_sessionPropose",params:Y,throwOnFailedPublish:!0});return await this.setProposal(se,xe({id:se},Y)),{uri:C,approval:Se}},this.pair=async i=>(await this.isInitialized(),await this.client.core.pairing.pair(i)),this.approve=async i=>{await this.isInitialized(),await this.isValidApprove(i);const{id:n,relayProtocol:o,namespaces:h,sessionProperties:d}=i,y=this.client.proposal.get(n);let{pairingTopic:w,proposer:S,requiredNamespaces:C,optionalNamespaces:O}=y;w=w||"";const D=await this.client.core.crypto.generateKeyPair(),Q=S.publicKey,U=await this.client.core.crypto.generateSharedKey(D,Q);w&&n&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:S.metadata}),await this.sendResult({id:n,topic:w,result:{relay:{protocol:o??"irn"},responderPublicKey:D}}),await this.client.proposal.delete(n,oe("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const Y=xe({relay:{protocol:o??"irn"},namespaces:h,pairingTopic:w,controller:{publicKey:D,metadata:this.client.metadata},expiry:Fe(us)},d&&{sessionProperties:d});await this.client.core.relayer.subscribe(U);const re=Ri(xe({},Y),{topic:U,requiredNamespaces:C,optionalNamespaces:O,pairingTopic:w,acknowledged:!1,self:Y.controller,peer:{publicKey:S.publicKey,metadata:S.metadata},controller:D});await this.client.session.set(U,re);try{await this.sendRequest({topic:U,method:"wc_sessionSettle",params:Y,throwOnFailedPublish:!0})}catch(X){throw this.client.logger.error(X),this.client.session.delete(U,oe("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(U),X}return await this.setExpiry(U,Fe(us)),{topic:U,acknowledged:()=>new Promise(X=>setTimeout(()=>X(this.client.session.get(U)),500))}},this.reject=async i=>{await this.isInitialized(),await this.isValidReject(i);const{id:n,reason:o}=i,{pairingTopic:h}=this.client.proposal.get(n);h&&(await this.sendError(n,h,o),await this.client.proposal.delete(n,oe("USER_DISCONNECTED")))},this.update=async i=>{await this.isInitialized(),await this.isValidUpdate(i);const{topic:n,namespaces:o}=i,h=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:d,resolve:y,reject:w}=Oi();return this.events.once(de("session_update",h),({error:S})=>{S?w(S):y()}),await this.client.session.update(n,{namespaces:o}),{acknowledged:d}},this.extend=async i=>{await this.isInitialized(),await this.isValidExtend(i);const{topic:n}=i,o=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:h,resolve:d,reject:y}=Oi();return this.events.once(de("session_extend",o),({error:w})=>{w?y(w):d()}),await this.setExpiry(n,Fe(us)),{acknowledged:h}},this.request=async i=>{await this.isInitialized(),await this.isValidRequest(i);const{chainId:n,request:o,topic:h,expiry:d=Ct.wc_sessionRequest.req.ttl}=i,y=Fv(),{done:w,resolve:S,reject:C}=Oi(d,"Request expired. Please try again.");return this.events.once(de("session_request",y),({error:O,result:D})=>{O?C(O):S(D)}),await Promise.all([new Promise(async O=>{await this.sendRequest({clientRpcId:y,topic:h,method:"wc_sessionRequest",params:{request:Ri(xe({},o),{expiryTimestamp:Fe(d)}),chainId:n},expiry:d,throwOnFailedPublish:!0}).catch(D=>C(D)),this.client.events.emit("session_request_sent",{topic:h,request:o,chainId:n,id:y}),O()}),new Promise(async O=>{const D=await _w(this.client.core.storage,Mu);ww({id:y,topic:h,wcDeepLink:D}),O()}),w()]).then(O=>O[2])},this.respond=async i=>{await this.isInitialized(),await this.isValidRespond(i);const{topic:n,response:o}=i,{id:h}=o;Ft(o)?await this.sendResult({id:h,topic:n,result:o.result,throwOnFailedPublish:!0}):$t(o)&&await this.sendError(h,n,o.error),this.cleanupAfterResponse(i)},this.ping=async i=>{await this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.client.session.keys.includes(n)){const o=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:h,resolve:d,reject:y}=Oi();this.events.once(de("session_ping",o),({error:w})=>{w?y(w):d()}),await h()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async i=>{await this.isInitialized(),await this.isValidEmit(i);const{topic:n,event:o,chainId:h}=i;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:o,chainId:h}})},this.disconnect=async i=>{await this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:oe("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:o}=R("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(o)}},this.find=i=>(this.isInitialized(),this.client.session.getAll().filter(n=>Mw(n,i))),this.getPendingSessionRequests=()=>this.client.pendingRequest.getAll(),this.cleanupDuplicatePairings=async i=>{if(i.pairingTopic)try{const n=this.client.core.pairing.pairings.get(i.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(h=>{var d,y;return((d=h.peerMetadata)==null?void 0:d.url)&&((y=h.peerMetadata)==null?void 0:y.url)===i.peer.metadata.url&&h.topic&&h.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async i=>{const{topic:n,expirerHasDeleted:o=!1,emitEvent:h=!0,id:d=0}=i,{self:y}=this.client.session.get(n);await this.client.core.relayer.unsubscribe(n),await this.client.session.delete(n,oe("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(y.publicKey)&&await this.client.core.crypto.deleteKeyPair(y.publicKey),this.client.core.crypto.keychain.has(n)&&await this.client.core.crypto.deleteSymKey(n),o||this.client.core.expirer.del(n),this.client.core.storage.removeItem(Mu).catch(w=>this.client.logger.warn(w)),this.getPendingSessionRequests().forEach(w=>{w.topic===n&&this.deletePendingSessionRequest(w.id,oe("USER_DISCONNECTED"))}),h&&this.client.events.emit("session_delete",{id:d,topic:n})},this.deleteProposal=async(i,n)=>{await Promise.all([this.client.proposal.delete(i,oe("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(i)])},this.deletePendingSessionRequest=async(i,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(i,n),o?Promise.resolve():this.client.core.expirer.del(i)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(h=>h.id!==i),o&&(this.sessionRequestQueue.state=xt.idle,this.client.events.emit("session_request_expire",{id:i}))},this.setExpiry=async(i,n)=>{this.client.session.keys.includes(i)&&await this.client.session.update(i,{expiry:n}),this.client.core.expirer.set(i,n)},this.setProposal=async(i,n)=>{await this.client.proposal.set(i,n),this.client.core.expirer.set(i,Fe(Ct.wc_sessionPropose.req.ttl))},this.setPendingSessionRequest=async i=>{const{id:n,topic:o,params:h,verifyContext:d}=i,y=h.request.expiryTimestamp||Fe(Ct.wc_sessionRequest.req.ttl);await this.client.pendingRequest.set(n,{id:n,topic:o,params:h,verifyContext:d}),y&&this.client.core.expirer.set(n,y)},this.sendRequest=async i=>{const{topic:n,method:o,params:h,expiry:d,relayRpcId:y,clientRpcId:w,throwOnFailedPublish:S}=i,C=cr(o,h,w);if(Di()&&n1.includes(o)){const Q=Ci(JSON.stringify(C));this.client.core.verify.register({attestationId:Q})}const O=await this.client.core.crypto.encode(n,C),D=Ct[o].req;return d&&(D.ttl=d),y&&(D.id=y),this.client.core.history.set(n,C),S?(D.internal=Ri(xe({},D.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,O,D)):this.client.core.relayer.publish(n,O,D).catch(Q=>this.client.logger.error(Q)),C.id},this.sendResult=async i=>{const{id:n,topic:o,result:h,throwOnFailedPublish:d}=i,y=ws(n,h),w=await this.client.core.crypto.encode(o,y),S=await this.client.core.history.get(o,n),C=Ct[S.request.method].res;d?(C.internal=Ri(xe({},C.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,w,C)):this.client.core.relayer.publish(o,w,C).catch(O=>this.client.logger.error(O)),await this.client.core.history.resolve(y)},this.sendError=async(i,n,o)=>{const h=rh(i,o),d=await this.client.core.crypto.encode(n,h),y=await this.client.core.history.get(n,i),w=Ct[y.request.method].res;this.client.core.relayer.publish(n,d,w),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const i=[],n=[];this.client.session.getAll().forEach(o=>{let h=!1;Gt(o.expiry)&&(h=!0),this.client.core.crypto.keychain.has(o.topic)||(h=!0),h&&i.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{Gt(o.expiryTimestamp)&&n.push(o.id)}),await Promise.all([...i.map(o=>this.deleteSession({topic:o})),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async i=>{this.requestQueue.queue.push(i),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===xt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=xt.active;const i=this.requestQueue.queue.shift();if(i)try{this.processRequest(i),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=xt.idle},this.processRequest=i=>{const{topic:n,payload:o}=i,h=o.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:o}=i,h=(await this.client.core.history.get(n,o.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=i=>{const{topic:n}=i,{message:o}=R("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(i,n)=>{const{params:o,id:h}=n;try{this.isValidConnect(xe({},n.params));const d=o.expiryTimestamp||Fe(Ct.wc_sessionPropose.req.ttl),y=xe({id:h,pairingTopic:i,expiryTimestamp:d},o);await this.setProposal(h,y);const w=Ci(JSON.stringify(n)),S=await this.getVerifyContext(w,y.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:y,verifyContext:S})}catch(d){await this.sendError(h,i,d),this.client.logger.error(d)}},this.onSessionProposeResponse=async(i,n)=>{const{id:o}=n;if(Ft(n)){const{result:h}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const d=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:d});const y=d.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:y});const w=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const S=await this.client.core.crypto.generateSharedKey(y,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:S});const C=await this.client.core.relayer.subscribe(S);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:C}),await this.client.core.pairing.activate({topic:i})}else $t(n)&&(await this.client.proposal.delete(o,oe("USER_DISCONNECTED")),this.events.emit(de("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(i,n)=>{const{id:o,params:h}=n;try{this.isValidSessionSettleRequest(h);const{relay:d,controller:y,expiry:w,namespaces:S,sessionProperties:C,pairingTopic:O}=n.params,D=xe({topic:i,relay:d,expiry:w,namespaces:S,acknowledged:!0,pairingTopic:O,requiredNamespaces:{},optionalNamespaces:{},controller:y.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:y.publicKey,metadata:y.metadata}},C&&{sessionProperties:C});await this.sendResult({id:n.id,topic:i,result:!0}),this.events.emit(de("session_connect"),{session:D}),this.cleanupDuplicatePairings(D)}catch(d){await this.sendError(o,i,d),this.client.logger.error(d)}},this.onSessionSettleResponse=async(i,n)=>{const{id:o}=n;Ft(n)?(await this.client.session.update(i,{acknowledged:!0}),this.events.emit(de("session_approve",o),{})):$t(n)&&(await this.client.session.delete(i,oe("USER_DISCONNECTED")),this.events.emit(de("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(i,n)=>{const{params:o,id:h}=n;try{const d=`${i}_session_update`,y=cs.get(d);if(y&&this.isRequestOutOfSync(y,h)){this.client.logger.info(`Discarding out of sync request - ${h}`);return}this.isValidUpdate(xe({topic:i},o)),await this.client.session.update(i,{namespaces:o.namespaces}),await this.sendResult({id:h,topic:i,result:!0}),this.client.events.emit("session_update",{id:h,topic:i,params:o}),cs.set(d,h)}catch(d){await this.sendError(h,i,d),this.client.logger.error(d)}},this.isRequestOutOfSync=(i,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(i.toString().slice(0,-3)),this.onSessionUpdateResponse=(i,n)=>{const{id:o}=n;Ft(n)?this.events.emit(de("session_update",o),{}):$t(n)&&this.events.emit(de("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(i,n)=>{const{id:o}=n;try{this.isValidExtend({topic:i}),await this.setExpiry(i,Fe(us)),await this.sendResult({id:o,topic:i,result:!0}),this.client.events.emit("session_extend",{id:o,topic:i})}catch(h){await this.sendError(o,i,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(i,n)=>{const{id:o}=n;Ft(n)?this.events.emit(de("session_extend",o),{}):$t(n)&&this.events.emit(de("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(i,n)=>{const{id:o}=n;try{this.isValidPing({topic:i}),await this.sendResult({id:o,topic:i,result:!0}),this.client.events.emit("session_ping",{id:o,topic:i})}catch(h){await this.sendError(o,i,h),this.client.logger.error(h)}},this.onSessionPingResponse=(i,n)=>{const{id:o}=n;setTimeout(()=>{Ft(n)?this.events.emit(de("session_ping",o),{}):$t(n)&&this.events.emit(de("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(i,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:i,reason:n.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(Pe.publish,async()=>{h(await this.deleteSession({topic:i,id:o}))})}),this.sendResult({id:o,topic:i,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:i,error:oe("USER_DISCONNECTED")})])}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(i,n)=>{const{id:o,params:h}=n;try{this.isValidRequest(xe({topic:i},h));const d=Ci(JSON.stringify(cr("wc_sessionRequest",h,o))),y=this.client.session.get(i),w=await this.getVerifyContext(d,y.peer.metadata),S={id:o,topic:i,params:h,verifyContext:w};await this.setPendingSessionRequest(S),this.addSessionRequestToSessionRequestQueue(S),this.processSessionRequestQueue()}catch(d){await this.sendError(o,i,d),this.client.logger.error(d)}},this.onSessionRequestResponse=(i,n)=>{const{id:o}=n;Ft(n)?this.events.emit(de("session_request",o),{result:n.result}):$t(n)&&this.events.emit(de("session_request",o),{error:n.error})},this.onSessionEventRequest=async(i,n)=>{const{id:o,params:h}=n;try{const d=`${i}_session_event_${h.event.name}`,y=cs.get(d);if(y&&this.isRequestOutOfSync(y,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(xe({topic:i},h)),this.client.events.emit("session_event",{id:o,topic:i,params:h}),cs.set(d,o)}catch(d){await this.sendError(o,i,d),this.client.logger.error(d)}},this.addSessionRequestToSessionRequestQueue=i=>{this.sessionRequestQueue.queue.push(i)},this.cleanupAfterResponse=i=>{this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=xt.idle,this.processSessionRequestQueue()},A.toMiliseconds(this.requestQueueDelay))},this.cleanupPendingSentRequestsForTopic=({topic:i,error:n})=>{const o=this.client.core.history.pending;o.length>0&&o.filter(h=>h.topic===i&&h.request.method==="wc_sessionRequest").forEach(h=>{this.events.emit(de("session_request",h.request.id),{error:n})})},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===xt.active){this.client.logger.info("session request queue is already active.");return}const i=this.sessionRequestQueue.queue[0];if(!i){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=xt.active,this.client.events.emit("session_request",i)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=i=>{if(i.active)return;const n=this.client.proposal.getAll().find(o=>o.pairingTopic===i.topic);n&&this.onSessionProposeRequest(i.topic,cr("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties},n.id))},this.isValidConnect=async i=>{if(!Ue(i)){const{message:w}=R("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(i)}`);throw new Error(w)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:h,sessionProperties:d,relays:y}=i;if($e(n)||await this.isValidPairingTopic(n),!Jw(y,!0)){const{message:w}=R("MISSING_OR_INVALID",`connect() relays: ${y}`);throw new Error(w)}!$e(o)&&hr(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!$e(h)&&hr(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),$e(d)||this.validateSessionProps(d,"sessionProperties")},this.validateNamespaces=(i,n)=>{const o=Qw(i,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async i=>{if(!Ue(i))throw new Error(R("MISSING_OR_INVALID",`approve() params: ${i}`).message);const{id:n,namespaces:o,relayProtocol:h,sessionProperties:d}=i;await this.isValidProposalId(n);const y=this.client.proposal.get(n),w=Fn(o,"approve()");if(w)throw new Error(w.message);const S=mu(y.requiredNamespaces,o,"approve()");if(S)throw new Error(S.message);if(!ve(h,!0)){const{message:C}=R("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(C)}$e(d)||this.validateSessionProps(d,"sessionProperties")},this.isValidReject=async i=>{if(!Ue(i)){const{message:h}=R("MISSING_OR_INVALID",`reject() params: ${i}`);throw new Error(h)}const{id:n,reason:o}=i;if(await this.isValidProposalId(n),!Zw(o)){const{message:h}=R("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(h)}},this.isValidSessionSettleRequest=i=>{if(!Ue(i)){const{message:S}=R("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(S)}const{relay:n,controller:o,namespaces:h,expiry:d}=i;if(!dh(n)){const{message:S}=R("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(S)}const y=Kw(o,"onSessionSettleRequest()");if(y)throw new Error(y.message);const w=Fn(h,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(Gt(d)){const{message:S}=R("EXPIRED","onSessionSettleRequest()");throw new Error(S)}},this.isValidUpdate=async i=>{if(!Ue(i)){const{message:w}=R("MISSING_OR_INVALID",`update() params: ${i}`);throw new Error(w)}const{topic:n,namespaces:o}=i;await this.isValidSessionTopic(n);const h=this.client.session.get(n),d=Fn(o,"update()");if(d)throw new Error(d.message);const y=mu(h.requiredNamespaces,o,"update()");if(y)throw new Error(y.message)},this.isValidExtend=async i=>{if(!Ue(i)){const{message:o}=R("MISSING_OR_INVALID",`extend() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionTopic(n)},this.isValidRequest=async i=>{if(!Ue(i)){const{message:w}=R("MISSING_OR_INVALID",`request() params: ${i}`);throw new Error(w)}const{topic:n,request:o,chainId:h,expiry:d}=i;await this.isValidSessionTopic(n);const{namespaces:y}=this.client.session.get(n);if(!yu(y,h)){const{message:w}=R("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(w)}if(!Xw(o)){const{message:w}=R("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(w)}if(!i0(y,h,o.method)){const{message:w}=R("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(w)}if(d&&!o0(d,Yn)){const{message:w}=R("MISSING_OR_INVALID",`request() expiry: ${d}. Expiry must be a number (in seconds) between ${Yn.min} and ${Yn.max}`);throw new Error(w)}},this.isValidRespond=async i=>{var n;if(!Ue(i)){const{message:d}=R("MISSING_OR_INVALID",`respond() params: ${i}`);throw new Error(d)}const{topic:o,response:h}=i;try{await this.isValidSessionTopic(o)}catch(d){throw(n=i==null?void 0:i.response)!=null&&n.id&&this.cleanupAfterResponse(i),d}if(!e0(h)){const{message:d}=R("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(h)}`);throw new Error(d)}},this.isValidPing=async i=>{if(!Ue(i)){const{message:o}=R("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async i=>{if(!Ue(i)){const{message:y}=R("MISSING_OR_INVALID",`emit() params: ${i}`);throw new Error(y)}const{topic:n,event:o,chainId:h}=i;await this.isValidSessionTopic(n);const{namespaces:d}=this.client.session.get(n);if(!yu(d,h)){const{message:y}=R("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(y)}if(!t0(o)){const{message:y}=R("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(y)}if(!r0(d,h,o.name)){const{message:y}=R("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(y)}},this.isValidDisconnect=async i=>{if(!Ue(i)){const{message:o}=R("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(i,n)=>{const o={verified:{verifyUrl:n.verifyUrl||Ni,validation:"UNKNOWN",origin:n.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:i,verifyUrl:n.verifyUrl});h&&(o.verified.origin=h.origin,o.verified.isScam=h.isScam,o.verified.validation=h.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.info(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(i,n)=>{Object.values(i).forEach(o=>{if(!ve(o,!1)){const{message:h}=R("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(h)}})}}async isInitialized(){if(!this.initialized){const{message:r}=R("NOT_INITIALIZED",this.name);throw new Error(r)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Pe.message,async r=>{const{topic:i,message:n}=r;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const o=await this.client.core.crypto.decode(i,n);try{fo(o)?(this.client.core.history.set(i,o),this.onRelayEventRequest({topic:i,payload:o})):go(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:i,payload:o}),this.client.core.history.delete(i,o.id)):this.onRelayEventUnknownPayload({topic:i,payload:o})}catch(h){this.client.logger.error(h)}})}registerExpirerEvents(){this.client.core.expirer.on(it.expired,async r=>{const{topic:i,id:n}=lh(r.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,R("EXPIRED"),!0);i?this.client.session.keys.includes(i)&&(await this.deleteSession({topic:i,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:i})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(or.create,r=>this.onPairingCreated(r))}isValidPairingTopic(r){if(!ve(r,!1)){const{message:i}=R("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:i}=R("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(Gt(this.client.core.pairing.pairings.get(r).expiry)){const{message:i}=R("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}async isValidSessionTopic(r){if(!ve(r,!1)){const{message:i}=R("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(i)}if(!this.client.session.keys.includes(r)){const{message:i}=R("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(i)}if(Gt(this.client.session.get(r).expiry)){await this.deleteSession({topic:r});const{message:i}=R("EXPIRED",`session topic: ${r}`);throw new Error(i)}if(!this.client.core.crypto.keychain.has(r)){const{message:i}=R("MISSING_OR_INVALID",`session topic does not exist in keychain: ${r}`);throw await this.deleteSession({topic:r}),new Error(i)}}async isValidSessionOrPairingTopic(r){if(this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if(ve(r,!1)){const{message:i}=R("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(i)}else{const{message:i}=R("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(i)}}async isValidProposalId(r){if(!Yw(r)){const{message:i}=R("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(i)}if(!this.client.proposal.keys.includes(r)){const{message:i}=R("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(i)}if(Gt(this.client.proposal.get(r).expiryTimestamp)){await this.deleteProposal(r);const{message:i}=R("EXPIRED",`proposal id: ${r}`);throw new Error(i)}}}class p1 extends bs{constructor(r,i){super(r,i,t1,Po),this.core=r,this.logger=i}}let d1=class extends bs{constructor(r,i){super(r,i,i1,Po),this.core=r,this.logger=i}};class f1 extends bs{constructor(r,i){super(r,i,s1,Po,n=>n.id),this.core=r,this.logger=i}}let g1=class Dh extends I0{constructor(r){super(r),this.protocol=Nh,this.version=Ch,this.name=Jn.name,this.events=new Qt.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(r==null?void 0:r.name)||Jn.name,this.metadata=(r==null?void 0:r.metadata)||pw();const i=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:ms(vs({level:(r==null?void 0:r.logger)||Jn.logger}));this.core=(r==null?void 0:r.core)||new e1(r),this.logger=Me(i,this.name),this.session=new d1(this.core,this.logger),this.proposal=new p1(this.core,this.logger),this.pendingRequest=new f1(this.core,this.logger),this.engine=new l1(this)}static async init(r){const i=new Dh(r);return await i.initialize(),i}get context(){return Be(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}};const Lu="error",y1="wss://relay.walletconnect.com",m1="wc",v1="universal_provider",Vu=`${m1}@2:${v1}:`,w1="https://rpc.walletconnect.com/v1/",At={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var sr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},uo={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(a,r){(function(){var i,n="4.17.21",o=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",d="Expected a function",y="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",S=500,C="__lodash_placeholder__",O=1,D=2,Q=4,U=1,Y=2,re=1,X=2,Se=4,se=8,ee=16,G=32,ye=64,he=128,Re=256,Tt=512,qh=30,jh="...",Uh=800,Mh=16,Oo=1,kh=2,zh=3,Yt=1/0,qt=9007199254740991,Lh=17976931348623157e292,gr=NaN,pt=4294967295,Vh=pt-1,Kh=pt>>>1,Hh=[["ary",he],["bind",re],["bindKey",X],["curry",se],["curryRight",ee],["flip",Tt],["partial",G],["partialRight",ye],["rearg",Re]],hi="[object Arguments]",yr="[object Array]",Fh="[object AsyncFunction]",Ti="[object Boolean]",qi="[object Date]",Gh="[object DOMException]",mr="[object Error]",vr="[object Function]",No="[object GeneratorFunction]",st="[object Map]",ji="[object Number]",Bh="[object Null]",vt="[object Object]",Co="[object Promise]",Wh="[object Proxy]",Ui="[object RegExp]",nt="[object Set]",Mi="[object String]",wr="[object Symbol]",Qh="[object Undefined]",ki="[object WeakMap]",Jh="[object WeakSet]",zi="[object ArrayBuffer]",li="[object DataView]",Es="[object Float32Array]",Is="[object Float64Array]",Ps="[object Int8Array]",Ss="[object Int16Array]",Rs="[object Int32Array]",Os="[object Uint8Array]",Ns="[object Uint8ClampedArray]",Cs="[object Uint16Array]",xs="[object Uint32Array]",Yh=/\b__p \+= '';/g,Zh=/\b(__p \+=) '' \+/g,Xh=/(__e\(.*?\)|\b__t\)) \+\n'';/g,xo=/&(?:amp|lt|gt|quot|#39);/g,$o=/[&<>"']/g,el=RegExp(xo.source),tl=RegExp($o.source),il=/<%-([\s\S]+?)%>/g,rl=/<%([\s\S]+?)%>/g,Do=/<%=([\s\S]+?)%>/g,sl=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nl=/^\w*$/,ol=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,$s=/[\\^$.*+?()[\]{}|]/g,al=RegExp($s.source),Ds=/^\s+/,cl=/\s/,ul=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,hl=/\{\n\/\* \[wrapped with (.+)\] \*/,ll=/,? & /,pl=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,dl=/[()=,{}\[\]\/\s]/,fl=/\\(\\)?/g,gl=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ao=/\w*$/,yl=/^[-+]0x[0-9a-f]+$/i,ml=/^0b[01]+$/i,vl=/^\[object .+?Constructor\]$/,wl=/^0o[0-7]+$/i,_l=/^(?:0|[1-9]\d*)$/,bl=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,_r=/($^)/,El=/['\n\r\u2028\u2029\\]/g,br="\\ud800-\\udfff",Il="\\u0300-\\u036f",Pl="\\ufe20-\\ufe2f",Sl="\\u20d0-\\u20ff",To=Il+Pl+Sl,qo="\\u2700-\\u27bf",jo="a-z\\xdf-\\xf6\\xf8-\\xff",Rl="\\xac\\xb1\\xd7\\xf7",Ol="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Nl="\\u2000-\\u206f",Cl=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Uo="A-Z\\xc0-\\xd6\\xd8-\\xde",Mo="\\ufe0e\\ufe0f",ko=Rl+Ol+Nl+Cl,As="['’]",xl="["+br+"]",zo="["+ko+"]",Er="["+To+"]",Lo="\\d+",$l="["+qo+"]",Vo="["+jo+"]",Ko="[^"+br+ko+Lo+qo+jo+Uo+"]",Ts="\\ud83c[\\udffb-\\udfff]",Dl="(?:"+Er+"|"+Ts+")",Ho="[^"+br+"]",qs="(?:\\ud83c[\\udde6-\\uddff]){2}",js="[\\ud800-\\udbff][\\udc00-\\udfff]",pi="["+Uo+"]",Fo="\\u200d",Go="(?:"+Vo+"|"+Ko+")",Al="(?:"+pi+"|"+Ko+")",Bo="(?:"+As+"(?:d|ll|m|re|s|t|ve))?",Wo="(?:"+As+"(?:D|LL|M|RE|S|T|VE))?",Qo=Dl+"?",Jo="["+Mo+"]?",Tl="(?:"+Fo+"(?:"+[Ho,qs,js].join("|")+")"+Jo+Qo+")*",ql="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",jl="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Yo=Jo+Qo+Tl,Ul="(?:"+[$l,qs,js].join("|")+")"+Yo,Ml="(?:"+[Ho+Er+"?",Er,qs,js,xl].join("|")+")",kl=RegExp(As,"g"),zl=RegExp(Er,"g"),Us=RegExp(Ts+"(?="+Ts+")|"+Ml+Yo,"g"),Ll=RegExp([pi+"?"+Vo+"+"+Bo+"(?="+[zo,pi,"$"].join("|")+")",Al+"+"+Wo+"(?="+[zo,pi+Go,"$"].join("|")+")",pi+"?"+Go+"+"+Bo,pi+"+"+Wo,jl,ql,Lo,Ul].join("|"),"g"),Vl=RegExp("["+Fo+br+To+Mo+"]"),Kl=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Hl=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Fl=-1,ie={};ie[Es]=ie[Is]=ie[Ps]=ie[Ss]=ie[Rs]=ie[Os]=ie[Ns]=ie[Cs]=ie[xs]=!0,ie[hi]=ie[yr]=ie[zi]=ie[Ti]=ie[li]=ie[qi]=ie[mr]=ie[vr]=ie[st]=ie[ji]=ie[vt]=ie[Ui]=ie[nt]=ie[Mi]=ie[ki]=!1;var te={};te[hi]=te[yr]=te[zi]=te[li]=te[Ti]=te[qi]=te[Es]=te[Is]=te[Ps]=te[Ss]=te[Rs]=te[st]=te[ji]=te[vt]=te[Ui]=te[nt]=te[Mi]=te[wr]=te[Os]=te[Ns]=te[Cs]=te[xs]=!0,te[mr]=te[vr]=te[ki]=!1;var Gl={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Bl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Wl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Ql={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Jl=parseFloat,Yl=parseInt,Zo=typeof sr=="object"&&sr&&sr.Object===Object&&sr,Zl=typeof self=="object"&&self&&self.Object===Object&&self,we=Zo||Zl||Function("return this")(),Ms=r&&!r.nodeType&&r,Zt=Ms&&!0&&a&&!a.nodeType&&a,Xo=Zt&&Zt.exports===Ms,ks=Xo&&Zo.process,We=function(){try{var m=Zt&&Zt.require&&Zt.require("util").types;return m||ks&&ks.binding&&ks.binding("util")}catch{}}(),ea=We&&We.isArrayBuffer,ta=We&&We.isDate,ia=We&&We.isMap,ra=We&&We.isRegExp,sa=We&&We.isSet,na=We&&We.isTypedArray;function ke(m,b,_){switch(_.length){case 0:return m.call(b);case 1:return m.call(b,_[0]);case 2:return m.call(b,_[0],_[1]);case 3:return m.call(b,_[0],_[1],_[2])}return m.apply(b,_)}function Xl(m,b,_,x){for(var M=-1,B=m==null?0:m.length;++M<B;){var fe=m[M];b(x,fe,_(fe),m)}return x}function Qe(m,b){for(var _=-1,x=m==null?0:m.length;++_<x&&b(m[_],_,m)!==!1;);return m}function ep(m,b){for(var _=m==null?0:m.length;_--&&b(m[_],_,m)!==!1;);return m}function oa(m,b){for(var _=-1,x=m==null?0:m.length;++_<x;)if(!b(m[_],_,m))return!1;return!0}function jt(m,b){for(var _=-1,x=m==null?0:m.length,M=0,B=[];++_<x;){var fe=m[_];b(fe,_,m)&&(B[M++]=fe)}return B}function Ir(m,b){var _=m==null?0:m.length;return!!_&&di(m,b,0)>-1}function zs(m,b,_){for(var x=-1,M=m==null?0:m.length;++x<M;)if(_(b,m[x]))return!0;return!1}function ne(m,b){for(var _=-1,x=m==null?0:m.length,M=Array(x);++_<x;)M[_]=b(m[_],_,m);return M}function Ut(m,b){for(var _=-1,x=b.length,M=m.length;++_<x;)m[M+_]=b[_];return m}function Ls(m,b,_,x){var M=-1,B=m==null?0:m.length;for(x&&B&&(_=m[++M]);++M<B;)_=b(_,m[M],M,m);return _}function tp(m,b,_,x){var M=m==null?0:m.length;for(x&&M&&(_=m[--M]);M--;)_=b(_,m[M],M,m);return _}function Vs(m,b){for(var _=-1,x=m==null?0:m.length;++_<x;)if(b(m[_],_,m))return!0;return!1}var ip=Ks("length");function rp(m){return m.split("")}function sp(m){return m.match(pl)||[]}function aa(m,b,_){var x;return _(m,function(M,B,fe){if(b(M,B,fe))return x=B,!1}),x}function Pr(m,b,_,x){for(var M=m.length,B=_+(x?1:-1);x?B--:++B<M;)if(b(m[B],B,m))return B;return-1}function di(m,b,_){return b===b?yp(m,b,_):Pr(m,ca,_)}function np(m,b,_,x){for(var M=_-1,B=m.length;++M<B;)if(x(m[M],b))return M;return-1}function ca(m){return m!==m}function ua(m,b){var _=m==null?0:m.length;return _?Fs(m,b)/_:gr}function Ks(m){return function(b){return b==null?i:b[m]}}function Hs(m){return function(b){return m==null?i:m[b]}}function ha(m,b,_,x,M){return M(m,function(B,fe,Z){_=x?(x=!1,B):b(_,B,fe,Z)}),_}function op(m,b){var _=m.length;for(m.sort(b);_--;)m[_]=m[_].value;return m}function Fs(m,b){for(var _,x=-1,M=m.length;++x<M;){var B=b(m[x]);B!==i&&(_=_===i?B:_+B)}return _}function Gs(m,b){for(var _=-1,x=Array(m);++_<m;)x[_]=b(_);return x}function ap(m,b){return ne(b,function(_){return[_,m[_]]})}function la(m){return m&&m.slice(0,ga(m)+1).replace(Ds,"")}function ze(m){return function(b){return m(b)}}function Bs(m,b){return ne(b,function(_){return m[_]})}function Li(m,b){return m.has(b)}function pa(m,b){for(var _=-1,x=m.length;++_<x&&di(b,m[_],0)>-1;);return _}function da(m,b){for(var _=m.length;_--&&di(b,m[_],0)>-1;);return _}function cp(m,b){for(var _=m.length,x=0;_--;)m[_]===b&&++x;return x}var up=Hs(Gl),hp=Hs(Bl);function lp(m){return"\\"+Ql[m]}function pp(m,b){return m==null?i:m[b]}function fi(m){return Vl.test(m)}function dp(m){return Kl.test(m)}function fp(m){for(var b,_=[];!(b=m.next()).done;)_.push(b.value);return _}function Ws(m){var b=-1,_=Array(m.size);return m.forEach(function(x,M){_[++b]=[M,x]}),_}function fa(m,b){return function(_){return m(b(_))}}function Mt(m,b){for(var _=-1,x=m.length,M=0,B=[];++_<x;){var fe=m[_];(fe===b||fe===C)&&(m[_]=C,B[M++]=_)}return B}function Sr(m){var b=-1,_=Array(m.size);return m.forEach(function(x){_[++b]=x}),_}function gp(m){var b=-1,_=Array(m.size);return m.forEach(function(x){_[++b]=[x,x]}),_}function yp(m,b,_){for(var x=_-1,M=m.length;++x<M;)if(m[x]===b)return x;return-1}function mp(m,b,_){for(var x=_+1;x--;)if(m[x]===b)return x;return x}function gi(m){return fi(m)?wp(m):ip(m)}function ot(m){return fi(m)?_p(m):rp(m)}function ga(m){for(var b=m.length;b--&&cl.test(m.charAt(b)););return b}var vp=Hs(Wl);function wp(m){for(var b=Us.lastIndex=0;Us.test(m);)++b;return b}function _p(m){return m.match(Us)||[]}function bp(m){return m.match(Ll)||[]}var Ep=function m(b){b=b==null?we:yi.defaults(we.Object(),b,yi.pick(we,Hl));var _=b.Array,x=b.Date,M=b.Error,B=b.Function,fe=b.Math,Z=b.Object,Qs=b.RegExp,Ip=b.String,Je=b.TypeError,Rr=_.prototype,Pp=B.prototype,mi=Z.prototype,Or=b["__core-js_shared__"],Nr=Pp.toString,J=mi.hasOwnProperty,Sp=0,ya=function(){var e=/[^.]+$/.exec(Or&&Or.keys&&Or.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Cr=mi.toString,Rp=Nr.call(Z),Op=we._,Np=Qs("^"+Nr.call(J).replace($s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xr=Xo?b.Buffer:i,kt=b.Symbol,$r=b.Uint8Array,ma=xr?xr.allocUnsafe:i,Dr=fa(Z.getPrototypeOf,Z),va=Z.create,wa=mi.propertyIsEnumerable,Ar=Rr.splice,_a=kt?kt.isConcatSpreadable:i,Vi=kt?kt.iterator:i,Xt=kt?kt.toStringTag:i,Tr=function(){try{var e=si(Z,"defineProperty");return e({},"",{}),e}catch{}}(),Cp=b.clearTimeout!==we.clearTimeout&&b.clearTimeout,xp=x&&x.now!==we.Date.now&&x.now,$p=b.setTimeout!==we.setTimeout&&b.setTimeout,qr=fe.ceil,jr=fe.floor,Js=Z.getOwnPropertySymbols,Dp=xr?xr.isBuffer:i,ba=b.isFinite,Ap=Rr.join,Tp=fa(Z.keys,Z),ge=fe.max,Ee=fe.min,qp=x.now,jp=b.parseInt,Ea=fe.random,Up=Rr.reverse,Ys=si(b,"DataView"),Ki=si(b,"Map"),Zs=si(b,"Promise"),vi=si(b,"Set"),Hi=si(b,"WeakMap"),Fi=si(Z,"create"),Ur=Hi&&new Hi,wi={},Mp=ni(Ys),kp=ni(Ki),zp=ni(Zs),Lp=ni(vi),Vp=ni(Hi),Mr=kt?kt.prototype:i,Gi=Mr?Mr.valueOf:i,Ia=Mr?Mr.toString:i;function l(e){if(ue(e)&&!k(e)&&!(e instanceof H)){if(e instanceof Ye)return e;if(J.call(e,"__wrapped__"))return Pc(e)}return new Ye(e)}var _i=function(){function e(){}return function(t){if(!ce(t))return{};if(va)return va(t);e.prototype=t;var s=new e;return e.prototype=i,s}}();function kr(){}function Ye(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}l.templateSettings={escape:il,evaluate:rl,interpolate:Do,variable:"",imports:{_:l}},l.prototype=kr.prototype,l.prototype.constructor=l,Ye.prototype=_i(kr.prototype),Ye.prototype.constructor=Ye;function H(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=pt,this.__views__=[]}function Kp(){var e=new H(this.__wrapped__);return e.__actions__=Ae(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Ae(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Ae(this.__views__),e}function Hp(){if(this.__filtered__){var e=new H(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Fp(){var e=this.__wrapped__.value(),t=this.__dir__,s=k(e),c=t<0,u=s?e.length:0,p=sf(0,u,this.__views__),f=p.start,g=p.end,v=g-f,E=c?g:f-1,I=this.__iteratees__,P=I.length,N=0,$=Ee(v,this.__takeCount__);if(!s||!c&&u==v&&$==v)return Ba(e,this.__actions__);var q=[];e:for(;v--&&N<$;){E+=t;for(var L=-1,j=e[E];++L<P;){var K=I[L],F=K.iteratee,Ke=K.type,Ce=F(j);if(Ke==kh)j=Ce;else if(!Ce){if(Ke==Oo)continue e;break e}}q[N++]=j}return q}H.prototype=_i(kr.prototype),H.prototype.constructor=H;function ei(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var c=e[t];this.set(c[0],c[1])}}function Gp(){this.__data__=Fi?Fi(null):{},this.size=0}function Bp(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Wp(e){var t=this.__data__;if(Fi){var s=t[e];return s===w?i:s}return J.call(t,e)?t[e]:i}function Qp(e){var t=this.__data__;return Fi?t[e]!==i:J.call(t,e)}function Jp(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=Fi&&t===i?w:t,this}ei.prototype.clear=Gp,ei.prototype.delete=Bp,ei.prototype.get=Wp,ei.prototype.has=Qp,ei.prototype.set=Jp;function wt(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var c=e[t];this.set(c[0],c[1])}}function Yp(){this.__data__=[],this.size=0}function Zp(e){var t=this.__data__,s=zr(t,e);if(s<0)return!1;var c=t.length-1;return s==c?t.pop():Ar.call(t,s,1),--this.size,!0}function Xp(e){var t=this.__data__,s=zr(t,e);return s<0?i:t[s][1]}function ed(e){return zr(this.__data__,e)>-1}function td(e,t){var s=this.__data__,c=zr(s,e);return c<0?(++this.size,s.push([e,t])):s[c][1]=t,this}wt.prototype.clear=Yp,wt.prototype.delete=Zp,wt.prototype.get=Xp,wt.prototype.has=ed,wt.prototype.set=td;function _t(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var c=e[t];this.set(c[0],c[1])}}function id(){this.size=0,this.__data__={hash:new ei,map:new(Ki||wt),string:new ei}}function rd(e){var t=Zr(this,e).delete(e);return this.size-=t?1:0,t}function sd(e){return Zr(this,e).get(e)}function nd(e){return Zr(this,e).has(e)}function od(e,t){var s=Zr(this,e),c=s.size;return s.set(e,t),this.size+=s.size==c?0:1,this}_t.prototype.clear=id,_t.prototype.delete=rd,_t.prototype.get=sd,_t.prototype.has=nd,_t.prototype.set=od;function ti(e){var t=-1,s=e==null?0:e.length;for(this.__data__=new _t;++t<s;)this.add(e[t])}function ad(e){return this.__data__.set(e,w),this}function cd(e){return this.__data__.has(e)}ti.prototype.add=ti.prototype.push=ad,ti.prototype.has=cd;function at(e){var t=this.__data__=new wt(e);this.size=t.size}function ud(){this.__data__=new wt,this.size=0}function hd(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}function ld(e){return this.__data__.get(e)}function pd(e){return this.__data__.has(e)}function dd(e,t){var s=this.__data__;if(s instanceof wt){var c=s.__data__;if(!Ki||c.length<o-1)return c.push([e,t]),this.size=++s.size,this;s=this.__data__=new _t(c)}return s.set(e,t),this.size=s.size,this}at.prototype.clear=ud,at.prototype.delete=hd,at.prototype.get=ld,at.prototype.has=pd,at.prototype.set=dd;function Pa(e,t){var s=k(e),c=!s&&oi(e),u=!s&&!c&&Ht(e),p=!s&&!c&&!u&&Pi(e),f=s||c||u||p,g=f?Gs(e.length,Ip):[],v=g.length;for(var E in e)(t||J.call(e,E))&&!(f&&(E=="length"||u&&(E=="offset"||E=="parent")||p&&(E=="buffer"||E=="byteLength"||E=="byteOffset")||Pt(E,v)))&&g.push(E);return g}function Sa(e){var t=e.length;return t?e[hn(0,t-1)]:i}function fd(e,t){return Xr(Ae(e),ii(t,0,e.length))}function gd(e){return Xr(Ae(e))}function Xs(e,t,s){(s!==i&&!ct(e[t],s)||s===i&&!(t in e))&&bt(e,t,s)}function Bi(e,t,s){var c=e[t];(!(J.call(e,t)&&ct(c,s))||s===i&&!(t in e))&&bt(e,t,s)}function zr(e,t){for(var s=e.length;s--;)if(ct(e[s][0],t))return s;return-1}function yd(e,t,s,c){return zt(e,function(u,p,f){t(c,u,s(u),f)}),c}function Ra(e,t){return e&&ft(t,me(t),e)}function md(e,t){return e&&ft(t,qe(t),e)}function bt(e,t,s){t=="__proto__"&&Tr?Tr(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}function en(e,t){for(var s=-1,c=t.length,u=_(c),p=e==null;++s<c;)u[s]=p?i:qn(e,t[s]);return u}function ii(e,t,s){return e===e&&(s!==i&&(e=e<=s?e:s),t!==i&&(e=e>=t?e:t)),e}function Ze(e,t,s,c,u,p){var f,g=t&O,v=t&D,E=t&Q;if(s&&(f=u?s(e,c,u,p):s(e)),f!==i)return f;if(!ce(e))return e;var I=k(e);if(I){if(f=of(e),!g)return Ae(e,f)}else{var P=Ie(e),N=P==vr||P==No;if(Ht(e))return Ja(e,g);if(P==vt||P==hi||N&&!u){if(f=v||N?{}:gc(e),!g)return v?Wd(e,md(f,e)):Bd(e,Ra(f,e))}else{if(!te[P])return u?e:{};f=af(e,P,g)}}p||(p=new at);var $=p.get(e);if($)return $;p.set(e,f),Hc(e)?e.forEach(function(j){f.add(Ze(j,t,s,j,e,p))}):Vc(e)&&e.forEach(function(j,K){f.set(K,Ze(j,t,s,K,e,p))});var q=E?v?bn:_n:v?qe:me,L=I?i:q(e);return Qe(L||e,function(j,K){L&&(K=j,j=e[K]),Bi(f,K,Ze(j,t,s,K,e,p))}),f}function vd(e){var t=me(e);return function(s){return Oa(s,e,t)}}function Oa(e,t,s){var c=s.length;if(e==null)return!c;for(e=Z(e);c--;){var u=s[c],p=t[u],f=e[u];if(f===i&&!(u in e)||!p(f))return!1}return!0}function Na(e,t,s){if(typeof e!="function")throw new Je(d);return er(function(){e.apply(i,s)},t)}function Wi(e,t,s,c){var u=-1,p=Ir,f=!0,g=e.length,v=[],E=t.length;if(!g)return v;s&&(t=ne(t,ze(s))),c?(p=zs,f=!1):t.length>=o&&(p=Li,f=!1,t=new ti(t));e:for(;++u<g;){var I=e[u],P=s==null?I:s(I);if(I=c||I!==0?I:0,f&&P===P){for(var N=E;N--;)if(t[N]===P)continue e;v.push(I)}else p(t,P,c)||v.push(I)}return v}var zt=tc(dt),Ca=tc(rn,!0);function wd(e,t){var s=!0;return zt(e,function(c,u,p){return s=!!t(c,u,p),s}),s}function Lr(e,t,s){for(var c=-1,u=e.length;++c<u;){var p=e[c],f=t(p);if(f!=null&&(g===i?f===f&&!Ve(f):s(f,g)))var g=f,v=p}return v}function _d(e,t,s,c){var u=e.length;for(s=z(s),s<0&&(s=-s>u?0:u+s),c=c===i||c>u?u:z(c),c<0&&(c+=u),c=s>c?0:Gc(c);s<c;)e[s++]=t;return e}function xa(e,t){var s=[];return zt(e,function(c,u,p){t(c,u,p)&&s.push(c)}),s}function _e(e,t,s,c,u){var p=-1,f=e.length;for(s||(s=uf),u||(u=[]);++p<f;){var g=e[p];t>0&&s(g)?t>1?_e(g,t-1,s,c,u):Ut(u,g):c||(u[u.length]=g)}return u}var tn=ic(),$a=ic(!0);function dt(e,t){return e&&tn(e,t,me)}function rn(e,t){return e&&$a(e,t,me)}function Vr(e,t){return jt(t,function(s){return St(e[s])})}function ri(e,t){t=Vt(t,e);for(var s=0,c=t.length;e!=null&&s<c;)e=e[gt(t[s++])];return s&&s==c?e:i}function Da(e,t,s){var c=t(e);return k(e)?c:Ut(c,s(e))}function Oe(e){return e==null?e===i?Qh:Bh:Xt&&Xt in Z(e)?rf(e):yf(e)}function sn(e,t){return e>t}function bd(e,t){return e!=null&&J.call(e,t)}function Ed(e,t){return e!=null&&t in Z(e)}function Id(e,t,s){return e>=Ee(t,s)&&e<ge(t,s)}function nn(e,t,s){for(var c=s?zs:Ir,u=e[0].length,p=e.length,f=p,g=_(p),v=1/0,E=[];f--;){var I=e[f];f&&t&&(I=ne(I,ze(t))),v=Ee(I.length,v),g[f]=!s&&(t||u>=120&&I.length>=120)?new ti(f&&I):i}I=e[0];var P=-1,N=g[0];e:for(;++P<u&&E.length<v;){var $=I[P],q=t?t($):$;if($=s||$!==0?$:0,!(N?Li(N,q):c(E,q,s))){for(f=p;--f;){var L=g[f];if(!(L?Li(L,q):c(e[f],q,s)))continue e}N&&N.push(q),E.push($)}}return E}function Pd(e,t,s,c){return dt(e,function(u,p,f){t(c,s(u),p,f)}),c}function Qi(e,t,s){t=Vt(t,e),e=wc(e,t);var c=e==null?e:e[gt(et(t))];return c==null?i:ke(c,e,s)}function Aa(e){return ue(e)&&Oe(e)==hi}function Sd(e){return ue(e)&&Oe(e)==zi}function Rd(e){return ue(e)&&Oe(e)==qi}function Ji(e,t,s,c,u){return e===t?!0:e==null||t==null||!ue(e)&&!ue(t)?e!==e&&t!==t:Od(e,t,s,c,Ji,u)}function Od(e,t,s,c,u,p){var f=k(e),g=k(t),v=f?yr:Ie(e),E=g?yr:Ie(t);v=v==hi?vt:v,E=E==hi?vt:E;var I=v==vt,P=E==vt,N=v==E;if(N&&Ht(e)){if(!Ht(t))return!1;f=!0,I=!1}if(N&&!I)return p||(p=new at),f||Pi(e)?pc(e,t,s,c,u,p):ef(e,t,v,s,c,u,p);if(!(s&U)){var $=I&&J.call(e,"__wrapped__"),q=P&&J.call(t,"__wrapped__");if($||q){var L=$?e.value():e,j=q?t.value():t;return p||(p=new at),u(L,j,s,c,p)}}return N?(p||(p=new at),tf(e,t,s,c,u,p)):!1}function Nd(e){return ue(e)&&Ie(e)==st}function on(e,t,s,c){var u=s.length,p=u,f=!c;if(e==null)return!p;for(e=Z(e);u--;){var g=s[u];if(f&&g[2]?g[1]!==e[g[0]]:!(g[0]in e))return!1}for(;++u<p;){g=s[u];var v=g[0],E=e[v],I=g[1];if(f&&g[2]){if(E===i&&!(v in e))return!1}else{var P=new at;if(c)var N=c(E,I,v,e,t,P);if(!(N===i?Ji(I,E,U|Y,c,P):N))return!1}}return!0}function Ta(e){if(!ce(e)||lf(e))return!1;var t=St(e)?Np:vl;return t.test(ni(e))}function Cd(e){return ue(e)&&Oe(e)==Ui}function xd(e){return ue(e)&&Ie(e)==nt}function $d(e){return ue(e)&&ns(e.length)&&!!ie[Oe(e)]}function qa(e){return typeof e=="function"?e:e==null?je:typeof e=="object"?k(e)?Ma(e[0],e[1]):Ua(e):ru(e)}function an(e){if(!Xi(e))return Tp(e);var t=[];for(var s in Z(e))J.call(e,s)&&s!="constructor"&&t.push(s);return t}function Dd(e){if(!ce(e))return gf(e);var t=Xi(e),s=[];for(var c in e)c=="constructor"&&(t||!J.call(e,c))||s.push(c);return s}function cn(e,t){return e<t}function ja(e,t){var s=-1,c=Te(e)?_(e.length):[];return zt(e,function(u,p,f){c[++s]=t(u,p,f)}),c}function Ua(e){var t=In(e);return t.length==1&&t[0][2]?mc(t[0][0],t[0][1]):function(s){return s===e||on(s,e,t)}}function Ma(e,t){return Sn(e)&&yc(t)?mc(gt(e),t):function(s){var c=qn(s,e);return c===i&&c===t?jn(s,e):Ji(t,c,U|Y)}}function Kr(e,t,s,c,u){e!==t&&tn(t,function(p,f){if(u||(u=new at),ce(p))Ad(e,t,f,s,Kr,c,u);else{var g=c?c(On(e,f),p,f+"",e,t,u):i;g===i&&(g=p),Xs(e,f,g)}},qe)}function Ad(e,t,s,c,u,p,f){var g=On(e,s),v=On(t,s),E=f.get(v);if(E){Xs(e,s,E);return}var I=p?p(g,v,s+"",e,t,f):i,P=I===i;if(P){var N=k(v),$=!N&&Ht(v),q=!N&&!$&&Pi(v);I=v,N||$||q?k(g)?I=g:le(g)?I=Ae(g):$?(P=!1,I=Ja(v,!0)):q?(P=!1,I=Ya(v,!0)):I=[]:tr(v)||oi(v)?(I=g,oi(g)?I=Bc(g):(!ce(g)||St(g))&&(I=gc(v))):P=!1}P&&(f.set(v,I),u(I,v,c,p,f),f.delete(v)),Xs(e,s,I)}function ka(e,t){var s=e.length;if(s)return t+=t<0?s:0,Pt(t,s)?e[t]:i}function za(e,t,s){t.length?t=ne(t,function(p){return k(p)?function(f){return ri(f,p.length===1?p[0]:p)}:p}):t=[je];var c=-1;t=ne(t,ze(T()));var u=ja(e,function(p,f,g){var v=ne(t,function(E){return E(p)});return{criteria:v,index:++c,value:p}});return op(u,function(p,f){return Gd(p,f,s)})}function Td(e,t){return La(e,t,function(s,c){return jn(e,c)})}function La(e,t,s){for(var c=-1,u=t.length,p={};++c<u;){var f=t[c],g=ri(e,f);s(g,f)&&Yi(p,Vt(f,e),g)}return p}function qd(e){return function(t){return ri(t,e)}}function un(e,t,s,c){var u=c?np:di,p=-1,f=t.length,g=e;for(e===t&&(t=Ae(t)),s&&(g=ne(e,ze(s)));++p<f;)for(var v=0,E=t[p],I=s?s(E):E;(v=u(g,I,v,c))>-1;)g!==e&&Ar.call(g,v,1),Ar.call(e,v,1);return e}function Va(e,t){for(var s=e?t.length:0,c=s-1;s--;){var u=t[s];if(s==c||u!==p){var p=u;Pt(u)?Ar.call(e,u,1):dn(e,u)}}return e}function hn(e,t){return e+jr(Ea()*(t-e+1))}function jd(e,t,s,c){for(var u=-1,p=ge(qr((t-e)/(s||1)),0),f=_(p);p--;)f[c?p:++u]=e,e+=s;return f}function ln(e,t){var s="";if(!e||t<1||t>qt)return s;do t%2&&(s+=e),t=jr(t/2),t&&(e+=e);while(t);return s}function V(e,t){return Nn(vc(e,t,je),e+"")}function Ud(e){return Sa(Si(e))}function Md(e,t){var s=Si(e);return Xr(s,ii(t,0,s.length))}function Yi(e,t,s,c){if(!ce(e))return e;t=Vt(t,e);for(var u=-1,p=t.length,f=p-1,g=e;g!=null&&++u<p;){var v=gt(t[u]),E=s;if(v==="__proto__"||v==="constructor"||v==="prototype")return e;if(u!=f){var I=g[v];E=c?c(I,v,g):i,E===i&&(E=ce(I)?I:Pt(t[u+1])?[]:{})}Bi(g,v,E),g=g[v]}return e}var Ka=Ur?function(e,t){return Ur.set(e,t),e}:je,kd=Tr?function(e,t){return Tr(e,"toString",{configurable:!0,enumerable:!1,value:Mn(t),writable:!0})}:je;function zd(e){return Xr(Si(e))}function Xe(e,t,s){var c=-1,u=e.length;t<0&&(t=-t>u?0:u+t),s=s>u?u:s,s<0&&(s+=u),u=t>s?0:s-t>>>0,t>>>=0;for(var p=_(u);++c<u;)p[c]=e[c+t];return p}function Ld(e,t){var s;return zt(e,function(c,u,p){return s=t(c,u,p),!s}),!!s}function Hr(e,t,s){var c=0,u=e==null?c:e.length;if(typeof t=="number"&&t===t&&u<=Kh){for(;c<u;){var p=c+u>>>1,f=e[p];f!==null&&!Ve(f)&&(s?f<=t:f<t)?c=p+1:u=p}return u}return pn(e,t,je,s)}function pn(e,t,s,c){var u=0,p=e==null?0:e.length;if(p===0)return 0;t=s(t);for(var f=t!==t,g=t===null,v=Ve(t),E=t===i;u<p;){var I=jr((u+p)/2),P=s(e[I]),N=P!==i,$=P===null,q=P===P,L=Ve(P);if(f)var j=c||q;else E?j=q&&(c||N):g?j=q&&N&&(c||!$):v?j=q&&N&&!$&&(c||!L):$||L?j=!1:j=c?P<=t:P<t;j?u=I+1:p=I}return Ee(p,Vh)}function Ha(e,t){for(var s=-1,c=e.length,u=0,p=[];++s<c;){var f=e[s],g=t?t(f):f;if(!s||!ct(g,v)){var v=g;p[u++]=f===0?0:f}}return p}function Fa(e){return typeof e=="number"?e:Ve(e)?gr:+e}function Le(e){if(typeof e=="string")return e;if(k(e))return ne(e,Le)+"";if(Ve(e))return Ia?Ia.call(e):"";var t=e+"";return t=="0"&&1/e==-Yt?"-0":t}function Lt(e,t,s){var c=-1,u=Ir,p=e.length,f=!0,g=[],v=g;if(s)f=!1,u=zs;else if(p>=o){var E=t?null:Zd(e);if(E)return Sr(E);f=!1,u=Li,v=new ti}else v=t?[]:g;e:for(;++c<p;){var I=e[c],P=t?t(I):I;if(I=s||I!==0?I:0,f&&P===P){for(var N=v.length;N--;)if(v[N]===P)continue e;t&&v.push(P),g.push(I)}else u(v,P,s)||(v!==g&&v.push(P),g.push(I))}return g}function dn(e,t){return t=Vt(t,e),e=wc(e,t),e==null||delete e[gt(et(t))]}function Ga(e,t,s,c){return Yi(e,t,s(ri(e,t)),c)}function Fr(e,t,s,c){for(var u=e.length,p=c?u:-1;(c?p--:++p<u)&&t(e[p],p,e););return s?Xe(e,c?0:p,c?p+1:u):Xe(e,c?p+1:0,c?u:p)}function Ba(e,t){var s=e;return s instanceof H&&(s=s.value()),Ls(t,function(c,u){return u.func.apply(u.thisArg,Ut([c],u.args))},s)}function fn(e,t,s){var c=e.length;if(c<2)return c?Lt(e[0]):[];for(var u=-1,p=_(c);++u<c;)for(var f=e[u],g=-1;++g<c;)g!=u&&(p[u]=Wi(p[u]||f,e[g],t,s));return Lt(_e(p,1),t,s)}function Wa(e,t,s){for(var c=-1,u=e.length,p=t.length,f={};++c<u;){var g=c<p?t[c]:i;s(f,e[c],g)}return f}function gn(e){return le(e)?e:[]}function yn(e){return typeof e=="function"?e:je}function Vt(e,t){return k(e)?e:Sn(e,t)?[e]:Ic(W(e))}var Vd=V;function Kt(e,t,s){var c=e.length;return s=s===i?c:s,!t&&s>=c?e:Xe(e,t,s)}var Qa=Cp||function(e){return we.clearTimeout(e)};function Ja(e,t){if(t)return e.slice();var s=e.length,c=ma?ma(s):new e.constructor(s);return e.copy(c),c}function mn(e){var t=new e.constructor(e.byteLength);return new $r(t).set(new $r(e)),t}function Kd(e,t){var s=t?mn(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function Hd(e){var t=new e.constructor(e.source,Ao.exec(e));return t.lastIndex=e.lastIndex,t}function Fd(e){return Gi?Z(Gi.call(e)):{}}function Ya(e,t){var s=t?mn(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function Za(e,t){if(e!==t){var s=e!==i,c=e===null,u=e===e,p=Ve(e),f=t!==i,g=t===null,v=t===t,E=Ve(t);if(!g&&!E&&!p&&e>t||p&&f&&v&&!g&&!E||c&&f&&v||!s&&v||!u)return 1;if(!c&&!p&&!E&&e<t||E&&s&&u&&!c&&!p||g&&s&&u||!f&&u||!v)return-1}return 0}function Gd(e,t,s){for(var c=-1,u=e.criteria,p=t.criteria,f=u.length,g=s.length;++c<f;){var v=Za(u[c],p[c]);if(v){if(c>=g)return v;var E=s[c];return v*(E=="desc"?-1:1)}}return e.index-t.index}function Xa(e,t,s,c){for(var u=-1,p=e.length,f=s.length,g=-1,v=t.length,E=ge(p-f,0),I=_(v+E),P=!c;++g<v;)I[g]=t[g];for(;++u<f;)(P||u<p)&&(I[s[u]]=e[u]);for(;E--;)I[g++]=e[u++];return I}function ec(e,t,s,c){for(var u=-1,p=e.length,f=-1,g=s.length,v=-1,E=t.length,I=ge(p-g,0),P=_(I+E),N=!c;++u<I;)P[u]=e[u];for(var $=u;++v<E;)P[$+v]=t[v];for(;++f<g;)(N||u<p)&&(P[$+s[f]]=e[u++]);return P}function Ae(e,t){var s=-1,c=e.length;for(t||(t=_(c));++s<c;)t[s]=e[s];return t}function ft(e,t,s,c){var u=!s;s||(s={});for(var p=-1,f=t.length;++p<f;){var g=t[p],v=c?c(s[g],e[g],g,s,e):i;v===i&&(v=e[g]),u?bt(s,g,v):Bi(s,g,v)}return s}function Bd(e,t){return ft(e,Pn(e),t)}function Wd(e,t){return ft(e,dc(e),t)}function Gr(e,t){return function(s,c){var u=k(s)?Xl:yd,p=t?t():{};return u(s,e,T(c,2),p)}}function bi(e){return V(function(t,s){var c=-1,u=s.length,p=u>1?s[u-1]:i,f=u>2?s[2]:i;for(p=e.length>3&&typeof p=="function"?(u--,p):i,f&&Ne(s[0],s[1],f)&&(p=u<3?i:p,u=1),t=Z(t);++c<u;){var g=s[c];g&&e(t,g,c,p)}return t})}function tc(e,t){return function(s,c){if(s==null)return s;if(!Te(s))return e(s,c);for(var u=s.length,p=t?u:-1,f=Z(s);(t?p--:++p<u)&&c(f[p],p,f)!==!1;);return s}}function ic(e){return function(t,s,c){for(var u=-1,p=Z(t),f=c(t),g=f.length;g--;){var v=f[e?g:++u];if(s(p[v],v,p)===!1)break}return t}}function Qd(e,t,s){var c=t&re,u=Zi(e);function p(){var f=this&&this!==we&&this instanceof p?u:e;return f.apply(c?s:this,arguments)}return p}function rc(e){return function(t){t=W(t);var s=fi(t)?ot(t):i,c=s?s[0]:t.charAt(0),u=s?Kt(s,1).join(""):t.slice(1);return c[e]()+u}}function Ei(e){return function(t){return Ls(tu(eu(t).replace(kl,"")),e,"")}}function Zi(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var s=_i(e.prototype),c=e.apply(s,t);return ce(c)?c:s}}function Jd(e,t,s){var c=Zi(e);function u(){for(var p=arguments.length,f=_(p),g=p,v=Ii(u);g--;)f[g]=arguments[g];var E=p<3&&f[0]!==v&&f[p-1]!==v?[]:Mt(f,v);if(p-=E.length,p<s)return cc(e,t,Br,u.placeholder,i,f,E,i,i,s-p);var I=this&&this!==we&&this instanceof u?c:e;return ke(I,this,f)}return u}function sc(e){return function(t,s,c){var u=Z(t);if(!Te(t)){var p=T(s,3);t=me(t),s=function(g){return p(u[g],g,u)}}var f=e(t,s,c);return f>-1?u[p?t[f]:f]:i}}function nc(e){return It(function(t){var s=t.length,c=s,u=Ye.prototype.thru;for(e&&t.reverse();c--;){var p=t[c];if(typeof p!="function")throw new Je(d);if(u&&!f&&Yr(p)=="wrapper")var f=new Ye([],!0)}for(c=f?c:s;++c<s;){p=t[c];var g=Yr(p),v=g=="wrapper"?En(p):i;v&&Rn(v[0])&&v[1]==(he|se|G|Re)&&!v[4].length&&v[9]==1?f=f[Yr(v[0])].apply(f,v[3]):f=p.length==1&&Rn(p)?f[g]():f.thru(p)}return function(){var E=arguments,I=E[0];if(f&&E.length==1&&k(I))return f.plant(I).value();for(var P=0,N=s?t[P].apply(this,E):I;++P<s;)N=t[P].call(this,N);return N}})}function Br(e,t,s,c,u,p,f,g,v,E){var I=t&he,P=t&re,N=t&X,$=t&(se|ee),q=t&Tt,L=N?i:Zi(e);function j(){for(var K=arguments.length,F=_(K),Ke=K;Ke--;)F[Ke]=arguments[Ke];if($)var Ce=Ii(j),He=cp(F,Ce);if(c&&(F=Xa(F,c,u,$)),p&&(F=ec(F,p,f,$)),K-=He,$&&K<E){var pe=Mt(F,Ce);return cc(e,t,Br,j.placeholder,s,F,pe,g,v,E-K)}var ut=P?s:this,Ot=N?ut[e]:e;return K=F.length,g?F=mf(F,g):q&&K>1&&F.reverse(),I&&v<K&&(F.length=v),this&&this!==we&&this instanceof j&&(Ot=L||Zi(Ot)),Ot.apply(ut,F)}return j}function oc(e,t){return function(s,c){return Pd(s,e,t(c),{})}}function Wr(e,t){return function(s,c){var u;if(s===i&&c===i)return t;if(s!==i&&(u=s),c!==i){if(u===i)return c;typeof s=="string"||typeof c=="string"?(s=Le(s),c=Le(c)):(s=Fa(s),c=Fa(c)),u=e(s,c)}return u}}function vn(e){return It(function(t){return t=ne(t,ze(T())),V(function(s){var c=this;return e(t,function(u){return ke(u,c,s)})})})}function Qr(e,t){t=t===i?" ":Le(t);var s=t.length;if(s<2)return s?ln(t,e):t;var c=ln(t,qr(e/gi(t)));return fi(t)?Kt(ot(c),0,e).join(""):c.slice(0,e)}function Yd(e,t,s,c){var u=t&re,p=Zi(e);function f(){for(var g=-1,v=arguments.length,E=-1,I=c.length,P=_(I+v),N=this&&this!==we&&this instanceof f?p:e;++E<I;)P[E]=c[E];for(;v--;)P[E++]=arguments[++g];return ke(N,u?s:this,P)}return f}function ac(e){return function(t,s,c){return c&&typeof c!="number"&&Ne(t,s,c)&&(s=c=i),t=Rt(t),s===i?(s=t,t=0):s=Rt(s),c=c===i?t<s?1:-1:Rt(c),jd(t,s,c,e)}}function Jr(e){return function(t,s){return typeof t=="string"&&typeof s=="string"||(t=tt(t),s=tt(s)),e(t,s)}}function cc(e,t,s,c,u,p,f,g,v,E){var I=t&se,P=I?f:i,N=I?i:f,$=I?p:i,q=I?i:p;t|=I?G:ye,t&=~(I?ye:G),t&Se||(t&=~(re|X));var L=[e,t,u,$,P,q,N,g,v,E],j=s.apply(i,L);return Rn(e)&&_c(j,L),j.placeholder=c,bc(j,e,t)}function wn(e){var t=fe[e];return function(s,c){if(s=tt(s),c=c==null?0:Ee(z(c),292),c&&ba(s)){var u=(W(s)+"e").split("e"),p=t(u[0]+"e"+(+u[1]+c));return u=(W(p)+"e").split("e"),+(u[0]+"e"+(+u[1]-c))}return t(s)}}var Zd=vi&&1/Sr(new vi([,-0]))[1]==Yt?function(e){return new vi(e)}:Ln;function uc(e){return function(t){var s=Ie(t);return s==st?Ws(t):s==nt?gp(t):ap(t,e(t))}}function Et(e,t,s,c,u,p,f,g){var v=t&X;if(!v&&typeof e!="function")throw new Je(d);var E=c?c.length:0;if(E||(t&=~(G|ye),c=u=i),f=f===i?f:ge(z(f),0),g=g===i?g:z(g),E-=u?u.length:0,t&ye){var I=c,P=u;c=u=i}var N=v?i:En(e),$=[e,t,s,c,u,I,P,p,f,g];if(N&&ff($,N),e=$[0],t=$[1],s=$[2],c=$[3],u=$[4],g=$[9]=$[9]===i?v?0:e.length:ge($[9]-E,0),!g&&t&(se|ee)&&(t&=~(se|ee)),!t||t==re)var q=Qd(e,t,s);else t==se||t==ee?q=Jd(e,t,g):(t==G||t==(re|G))&&!u.length?q=Yd(e,t,s,c):q=Br.apply(i,$);var L=N?Ka:_c;return bc(L(q,$),e,t)}function hc(e,t,s,c){return e===i||ct(e,mi[s])&&!J.call(c,s)?t:e}function lc(e,t,s,c,u,p){return ce(e)&&ce(t)&&(p.set(t,e),Kr(e,t,i,lc,p),p.delete(t)),e}function Xd(e){return tr(e)?i:e}function pc(e,t,s,c,u,p){var f=s&U,g=e.length,v=t.length;if(g!=v&&!(f&&v>g))return!1;var E=p.get(e),I=p.get(t);if(E&&I)return E==t&&I==e;var P=-1,N=!0,$=s&Y?new ti:i;for(p.set(e,t),p.set(t,e);++P<g;){var q=e[P],L=t[P];if(c)var j=f?c(L,q,P,t,e,p):c(q,L,P,e,t,p);if(j!==i){if(j)continue;N=!1;break}if($){if(!Vs(t,function(K,F){if(!Li($,F)&&(q===K||u(q,K,s,c,p)))return $.push(F)})){N=!1;break}}else if(!(q===L||u(q,L,s,c,p))){N=!1;break}}return p.delete(e),p.delete(t),N}function ef(e,t,s,c,u,p,f){switch(s){case li:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case zi:return!(e.byteLength!=t.byteLength||!p(new $r(e),new $r(t)));case Ti:case qi:case ji:return ct(+e,+t);case mr:return e.name==t.name&&e.message==t.message;case Ui:case Mi:return e==t+"";case st:var g=Ws;case nt:var v=c&U;if(g||(g=Sr),e.size!=t.size&&!v)return!1;var E=f.get(e);if(E)return E==t;c|=Y,f.set(e,t);var I=pc(g(e),g(t),c,u,p,f);return f.delete(e),I;case wr:if(Gi)return Gi.call(e)==Gi.call(t)}return!1}function tf(e,t,s,c,u,p){var f=s&U,g=_n(e),v=g.length,E=_n(t),I=E.length;if(v!=I&&!f)return!1;for(var P=v;P--;){var N=g[P];if(!(f?N in t:J.call(t,N)))return!1}var $=p.get(e),q=p.get(t);if($&&q)return $==t&&q==e;var L=!0;p.set(e,t),p.set(t,e);for(var j=f;++P<v;){N=g[P];var K=e[N],F=t[N];if(c)var Ke=f?c(F,K,N,t,e,p):c(K,F,N,e,t,p);if(!(Ke===i?K===F||u(K,F,s,c,p):Ke)){L=!1;break}j||(j=N=="constructor")}if(L&&!j){var Ce=e.constructor,He=t.constructor;Ce!=He&&"constructor"in e&&"constructor"in t&&!(typeof Ce=="function"&&Ce instanceof Ce&&typeof He=="function"&&He instanceof He)&&(L=!1)}return p.delete(e),p.delete(t),L}function It(e){return Nn(vc(e,i,Oc),e+"")}function _n(e){return Da(e,me,Pn)}function bn(e){return Da(e,qe,dc)}var En=Ur?function(e){return Ur.get(e)}:Ln;function Yr(e){for(var t=e.name+"",s=wi[t],c=J.call(wi,t)?s.length:0;c--;){var u=s[c],p=u.func;if(p==null||p==e)return u.name}return t}function Ii(e){var t=J.call(l,"placeholder")?l:e;return t.placeholder}function T(){var e=l.iteratee||kn;return e=e===kn?qa:e,arguments.length?e(arguments[0],arguments[1]):e}function Zr(e,t){var s=e.__data__;return hf(t)?s[typeof t=="string"?"string":"hash"]:s.map}function In(e){for(var t=me(e),s=t.length;s--;){var c=t[s],u=e[c];t[s]=[c,u,yc(u)]}return t}function si(e,t){var s=pp(e,t);return Ta(s)?s:i}function rf(e){var t=J.call(e,Xt),s=e[Xt];try{e[Xt]=i;var c=!0}catch{}var u=Cr.call(e);return c&&(t?e[Xt]=s:delete e[Xt]),u}var Pn=Js?function(e){return e==null?[]:(e=Z(e),jt(Js(e),function(t){return wa.call(e,t)}))}:Vn,dc=Js?function(e){for(var t=[];e;)Ut(t,Pn(e)),e=Dr(e);return t}:Vn,Ie=Oe;(Ys&&Ie(new Ys(new ArrayBuffer(1)))!=li||Ki&&Ie(new Ki)!=st||Zs&&Ie(Zs.resolve())!=Co||vi&&Ie(new vi)!=nt||Hi&&Ie(new Hi)!=ki)&&(Ie=function(e){var t=Oe(e),s=t==vt?e.constructor:i,c=s?ni(s):"";if(c)switch(c){case Mp:return li;case kp:return st;case zp:return Co;case Lp:return nt;case Vp:return ki}return t});function sf(e,t,s){for(var c=-1,u=s.length;++c<u;){var p=s[c],f=p.size;switch(p.type){case"drop":e+=f;break;case"dropRight":t-=f;break;case"take":t=Ee(t,e+f);break;case"takeRight":e=ge(e,t-f);break}}return{start:e,end:t}}function nf(e){var t=e.match(hl);return t?t[1].split(ll):[]}function fc(e,t,s){t=Vt(t,e);for(var c=-1,u=t.length,p=!1;++c<u;){var f=gt(t[c]);if(!(p=e!=null&&s(e,f)))break;e=e[f]}return p||++c!=u?p:(u=e==null?0:e.length,!!u&&ns(u)&&Pt(f,u)&&(k(e)||oi(e)))}function of(e){var t=e.length,s=new e.constructor(t);return t&&typeof e[0]=="string"&&J.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function gc(e){return typeof e.constructor=="function"&&!Xi(e)?_i(Dr(e)):{}}function af(e,t,s){var c=e.constructor;switch(t){case zi:return mn(e);case Ti:case qi:return new c(+e);case li:return Kd(e,s);case Es:case Is:case Ps:case Ss:case Rs:case Os:case Ns:case Cs:case xs:return Ya(e,s);case st:return new c;case ji:case Mi:return new c(e);case Ui:return Hd(e);case nt:return new c;case wr:return Fd(e)}}function cf(e,t){var s=t.length;if(!s)return e;var c=s-1;return t[c]=(s>1?"& ":"")+t[c],t=t.join(s>2?", ":" "),e.replace(ul,`{
/* [wrapped with `+t+`] */
`)}function uf(e){return k(e)||oi(e)||!!(_a&&e&&e[_a])}function Pt(e,t){var s=typeof e;return t=t??qt,!!t&&(s=="number"||s!="symbol"&&_l.test(e))&&e>-1&&e%1==0&&e<t}function Ne(e,t,s){if(!ce(s))return!1;var c=typeof t;return(c=="number"?Te(s)&&Pt(t,s.length):c=="string"&&t in s)?ct(s[t],e):!1}function Sn(e,t){if(k(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||Ve(e)?!0:nl.test(e)||!sl.test(e)||t!=null&&e in Z(t)}function hf(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Rn(e){var t=Yr(e),s=l[t];if(typeof s!="function"||!(t in H.prototype))return!1;if(e===s)return!0;var c=En(s);return!!c&&e===c[0]}function lf(e){return!!ya&&ya in e}var pf=Or?St:Kn;function Xi(e){var t=e&&e.constructor,s=typeof t=="function"&&t.prototype||mi;return e===s}function yc(e){return e===e&&!ce(e)}function mc(e,t){return function(s){return s==null?!1:s[e]===t&&(t!==i||e in Z(s))}}function df(e){var t=rs(e,function(c){return s.size===S&&s.clear(),c}),s=t.cache;return t}function ff(e,t){var s=e[1],c=t[1],u=s|c,p=u<(re|X|he),f=c==he&&s==se||c==he&&s==Re&&e[7].length<=t[8]||c==(he|Re)&&t[7].length<=t[8]&&s==se;if(!(p||f))return e;c&re&&(e[2]=t[2],u|=s&re?0:Se);var g=t[3];if(g){var v=e[3];e[3]=v?Xa(v,g,t[4]):g,e[4]=v?Mt(e[3],C):t[4]}return g=t[5],g&&(v=e[5],e[5]=v?ec(v,g,t[6]):g,e[6]=v?Mt(e[5],C):t[6]),g=t[7],g&&(e[7]=g),c&he&&(e[8]=e[8]==null?t[8]:Ee(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=u,e}function gf(e){var t=[];if(e!=null)for(var s in Z(e))t.push(s);return t}function yf(e){return Cr.call(e)}function vc(e,t,s){return t=ge(t===i?e.length-1:t,0),function(){for(var c=arguments,u=-1,p=ge(c.length-t,0),f=_(p);++u<p;)f[u]=c[t+u];u=-1;for(var g=_(t+1);++u<t;)g[u]=c[u];return g[t]=s(f),ke(e,this,g)}}function wc(e,t){return t.length<2?e:ri(e,Xe(t,0,-1))}function mf(e,t){for(var s=e.length,c=Ee(t.length,s),u=Ae(e);c--;){var p=t[c];e[c]=Pt(p,s)?u[p]:i}return e}function On(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var _c=Ec(Ka),er=$p||function(e,t){return we.setTimeout(e,t)},Nn=Ec(kd);function bc(e,t,s){var c=t+"";return Nn(e,cf(c,vf(nf(c),s)))}function Ec(e){var t=0,s=0;return function(){var c=qp(),u=Mh-(c-s);if(s=c,u>0){if(++t>=Uh)return arguments[0]}else t=0;return e.apply(i,arguments)}}function Xr(e,t){var s=-1,c=e.length,u=c-1;for(t=t===i?c:t;++s<t;){var p=hn(s,u),f=e[p];e[p]=e[s],e[s]=f}return e.length=t,e}var Ic=df(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(ol,function(s,c,u,p){t.push(u?p.replace(fl,"$1"):c||s)}),t});function gt(e){if(typeof e=="string"||Ve(e))return e;var t=e+"";return t=="0"&&1/e==-Yt?"-0":t}function ni(e){if(e!=null){try{return Nr.call(e)}catch{}try{return e+""}catch{}}return""}function vf(e,t){return Qe(Hh,function(s){var c="_."+s[0];t&s[1]&&!Ir(e,c)&&e.push(c)}),e.sort()}function Pc(e){if(e instanceof H)return e.clone();var t=new Ye(e.__wrapped__,e.__chain__);return t.__actions__=Ae(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function wf(e,t,s){(s?Ne(e,t,s):t===i)?t=1:t=ge(z(t),0);var c=e==null?0:e.length;if(!c||t<1)return[];for(var u=0,p=0,f=_(qr(c/t));u<c;)f[p++]=Xe(e,u,u+=t);return f}function _f(e){for(var t=-1,s=e==null?0:e.length,c=0,u=[];++t<s;){var p=e[t];p&&(u[c++]=p)}return u}function bf(){var e=arguments.length;if(!e)return[];for(var t=_(e-1),s=arguments[0],c=e;c--;)t[c-1]=arguments[c];return Ut(k(s)?Ae(s):[s],_e(t,1))}var Ef=V(function(e,t){return le(e)?Wi(e,_e(t,1,le,!0)):[]}),If=V(function(e,t){var s=et(t);return le(s)&&(s=i),le(e)?Wi(e,_e(t,1,le,!0),T(s,2)):[]}),Pf=V(function(e,t){var s=et(t);return le(s)&&(s=i),le(e)?Wi(e,_e(t,1,le,!0),i,s):[]});function Sf(e,t,s){var c=e==null?0:e.length;return c?(t=s||t===i?1:z(t),Xe(e,t<0?0:t,c)):[]}function Rf(e,t,s){var c=e==null?0:e.length;return c?(t=s||t===i?1:z(t),t=c-t,Xe(e,0,t<0?0:t)):[]}function Of(e,t){return e&&e.length?Fr(e,T(t,3),!0,!0):[]}function Nf(e,t){return e&&e.length?Fr(e,T(t,3),!0):[]}function Cf(e,t,s,c){var u=e==null?0:e.length;return u?(s&&typeof s!="number"&&Ne(e,t,s)&&(s=0,c=u),_d(e,t,s,c)):[]}function Sc(e,t,s){var c=e==null?0:e.length;if(!c)return-1;var u=s==null?0:z(s);return u<0&&(u=ge(c+u,0)),Pr(e,T(t,3),u)}function Rc(e,t,s){var c=e==null?0:e.length;if(!c)return-1;var u=c-1;return s!==i&&(u=z(s),u=s<0?ge(c+u,0):Ee(u,c-1)),Pr(e,T(t,3),u,!0)}function Oc(e){var t=e==null?0:e.length;return t?_e(e,1):[]}function xf(e){var t=e==null?0:e.length;return t?_e(e,Yt):[]}function $f(e,t){var s=e==null?0:e.length;return s?(t=t===i?1:z(t),_e(e,t)):[]}function Df(e){for(var t=-1,s=e==null?0:e.length,c={};++t<s;){var u=e[t];c[u[0]]=u[1]}return c}function Nc(e){return e&&e.length?e[0]:i}function Af(e,t,s){var c=e==null?0:e.length;if(!c)return-1;var u=s==null?0:z(s);return u<0&&(u=ge(c+u,0)),di(e,t,u)}function Tf(e){var t=e==null?0:e.length;return t?Xe(e,0,-1):[]}var qf=V(function(e){var t=ne(e,gn);return t.length&&t[0]===e[0]?nn(t):[]}),jf=V(function(e){var t=et(e),s=ne(e,gn);return t===et(s)?t=i:s.pop(),s.length&&s[0]===e[0]?nn(s,T(t,2)):[]}),Uf=V(function(e){var t=et(e),s=ne(e,gn);return t=typeof t=="function"?t:i,t&&s.pop(),s.length&&s[0]===e[0]?nn(s,i,t):[]});function Mf(e,t){return e==null?"":Ap.call(e,t)}function et(e){var t=e==null?0:e.length;return t?e[t-1]:i}function kf(e,t,s){var c=e==null?0:e.length;if(!c)return-1;var u=c;return s!==i&&(u=z(s),u=u<0?ge(c+u,0):Ee(u,c-1)),t===t?mp(e,t,u):Pr(e,ca,u,!0)}function zf(e,t){return e&&e.length?ka(e,z(t)):i}var Lf=V(Cc);function Cc(e,t){return e&&e.length&&t&&t.length?un(e,t):e}function Vf(e,t,s){return e&&e.length&&t&&t.length?un(e,t,T(s,2)):e}function Kf(e,t,s){return e&&e.length&&t&&t.length?un(e,t,i,s):e}var Hf=It(function(e,t){var s=e==null?0:e.length,c=en(e,t);return Va(e,ne(t,function(u){return Pt(u,s)?+u:u}).sort(Za)),c});function Ff(e,t){var s=[];if(!(e&&e.length))return s;var c=-1,u=[],p=e.length;for(t=T(t,3);++c<p;){var f=e[c];t(f,c,e)&&(s.push(f),u.push(c))}return Va(e,u),s}function Cn(e){return e==null?e:Up.call(e)}function Gf(e,t,s){var c=e==null?0:e.length;return c?(s&&typeof s!="number"&&Ne(e,t,s)?(t=0,s=c):(t=t==null?0:z(t),s=s===i?c:z(s)),Xe(e,t,s)):[]}function Bf(e,t){return Hr(e,t)}function Wf(e,t,s){return pn(e,t,T(s,2))}function Qf(e,t){var s=e==null?0:e.length;if(s){var c=Hr(e,t);if(c<s&&ct(e[c],t))return c}return-1}function Jf(e,t){return Hr(e,t,!0)}function Yf(e,t,s){return pn(e,t,T(s,2),!0)}function Zf(e,t){var s=e==null?0:e.length;if(s){var c=Hr(e,t,!0)-1;if(ct(e[c],t))return c}return-1}function Xf(e){return e&&e.length?Ha(e):[]}function eg(e,t){return e&&e.length?Ha(e,T(t,2)):[]}function tg(e){var t=e==null?0:e.length;return t?Xe(e,1,t):[]}function ig(e,t,s){return e&&e.length?(t=s||t===i?1:z(t),Xe(e,0,t<0?0:t)):[]}function rg(e,t,s){var c=e==null?0:e.length;return c?(t=s||t===i?1:z(t),t=c-t,Xe(e,t<0?0:t,c)):[]}function sg(e,t){return e&&e.length?Fr(e,T(t,3),!1,!0):[]}function ng(e,t){return e&&e.length?Fr(e,T(t,3)):[]}var og=V(function(e){return Lt(_e(e,1,le,!0))}),ag=V(function(e){var t=et(e);return le(t)&&(t=i),Lt(_e(e,1,le,!0),T(t,2))}),cg=V(function(e){var t=et(e);return t=typeof t=="function"?t:i,Lt(_e(e,1,le,!0),i,t)});function ug(e){return e&&e.length?Lt(e):[]}function hg(e,t){return e&&e.length?Lt(e,T(t,2)):[]}function lg(e,t){return t=typeof t=="function"?t:i,e&&e.length?Lt(e,i,t):[]}function xn(e){if(!(e&&e.length))return[];var t=0;return e=jt(e,function(s){if(le(s))return t=ge(s.length,t),!0}),Gs(t,function(s){return ne(e,Ks(s))})}function xc(e,t){if(!(e&&e.length))return[];var s=xn(e);return t==null?s:ne(s,function(c){return ke(t,i,c)})}var pg=V(function(e,t){return le(e)?Wi(e,t):[]}),dg=V(function(e){return fn(jt(e,le))}),fg=V(function(e){var t=et(e);return le(t)&&(t=i),fn(jt(e,le),T(t,2))}),gg=V(function(e){var t=et(e);return t=typeof t=="function"?t:i,fn(jt(e,le),i,t)}),yg=V(xn);function mg(e,t){return Wa(e||[],t||[],Bi)}function vg(e,t){return Wa(e||[],t||[],Yi)}var wg=V(function(e){var t=e.length,s=t>1?e[t-1]:i;return s=typeof s=="function"?(e.pop(),s):i,xc(e,s)});function $c(e){var t=l(e);return t.__chain__=!0,t}function _g(e,t){return t(e),e}function es(e,t){return t(e)}var bg=It(function(e){var t=e.length,s=t?e[0]:0,c=this.__wrapped__,u=function(p){return en(p,e)};return t>1||this.__actions__.length||!(c instanceof H)||!Pt(s)?this.thru(u):(c=c.slice(s,+s+(t?1:0)),c.__actions__.push({func:es,args:[u],thisArg:i}),new Ye(c,this.__chain__).thru(function(p){return t&&!p.length&&p.push(i),p}))});function Eg(){return $c(this)}function Ig(){return new Ye(this.value(),this.__chain__)}function Pg(){this.__values__===i&&(this.__values__=Fc(this.value()));var e=this.__index__>=this.__values__.length,t=e?i:this.__values__[this.__index__++];return{done:e,value:t}}function Sg(){return this}function Rg(e){for(var t,s=this;s instanceof kr;){var c=Pc(s);c.__index__=0,c.__values__=i,t?u.__wrapped__=c:t=c;var u=c;s=s.__wrapped__}return u.__wrapped__=e,t}function Og(){var e=this.__wrapped__;if(e instanceof H){var t=e;return this.__actions__.length&&(t=new H(this)),t=t.reverse(),t.__actions__.push({func:es,args:[Cn],thisArg:i}),new Ye(t,this.__chain__)}return this.thru(Cn)}function Ng(){return Ba(this.__wrapped__,this.__actions__)}var Cg=Gr(function(e,t,s){J.call(e,s)?++e[s]:bt(e,s,1)});function xg(e,t,s){var c=k(e)?oa:wd;return s&&Ne(e,t,s)&&(t=i),c(e,T(t,3))}function $g(e,t){var s=k(e)?jt:xa;return s(e,T(t,3))}var Dg=sc(Sc),Ag=sc(Rc);function Tg(e,t){return _e(ts(e,t),1)}function qg(e,t){return _e(ts(e,t),Yt)}function jg(e,t,s){return s=s===i?1:z(s),_e(ts(e,t),s)}function Dc(e,t){var s=k(e)?Qe:zt;return s(e,T(t,3))}function Ac(e,t){var s=k(e)?ep:Ca;return s(e,T(t,3))}var Ug=Gr(function(e,t,s){J.call(e,s)?e[s].push(t):bt(e,s,[t])});function Mg(e,t,s,c){e=Te(e)?e:Si(e),s=s&&!c?z(s):0;var u=e.length;return s<0&&(s=ge(u+s,0)),os(e)?s<=u&&e.indexOf(t,s)>-1:!!u&&di(e,t,s)>-1}var kg=V(function(e,t,s){var c=-1,u=typeof t=="function",p=Te(e)?_(e.length):[];return zt(e,function(f){p[++c]=u?ke(t,f,s):Qi(f,t,s)}),p}),zg=Gr(function(e,t,s){bt(e,s,t)});function ts(e,t){var s=k(e)?ne:ja;return s(e,T(t,3))}function Lg(e,t,s,c){return e==null?[]:(k(t)||(t=t==null?[]:[t]),s=c?i:s,k(s)||(s=s==null?[]:[s]),za(e,t,s))}var Vg=Gr(function(e,t,s){e[s?0:1].push(t)},function(){return[[],[]]});function Kg(e,t,s){var c=k(e)?Ls:ha,u=arguments.length<3;return c(e,T(t,4),s,u,zt)}function Hg(e,t,s){var c=k(e)?tp:ha,u=arguments.length<3;return c(e,T(t,4),s,u,Ca)}function Fg(e,t){var s=k(e)?jt:xa;return s(e,ss(T(t,3)))}function Gg(e){var t=k(e)?Sa:Ud;return t(e)}function Bg(e,t,s){(s?Ne(e,t,s):t===i)?t=1:t=z(t);var c=k(e)?fd:Md;return c(e,t)}function Wg(e){var t=k(e)?gd:zd;return t(e)}function Qg(e){if(e==null)return 0;if(Te(e))return os(e)?gi(e):e.length;var t=Ie(e);return t==st||t==nt?e.size:an(e).length}function Jg(e,t,s){var c=k(e)?Vs:Ld;return s&&Ne(e,t,s)&&(t=i),c(e,T(t,3))}var Yg=V(function(e,t){if(e==null)return[];var s=t.length;return s>1&&Ne(e,t[0],t[1])?t=[]:s>2&&Ne(t[0],t[1],t[2])&&(t=[t[0]]),za(e,_e(t,1),[])}),is=xp||function(){return we.Date.now()};function Zg(e,t){if(typeof t!="function")throw new Je(d);return e=z(e),function(){if(--e<1)return t.apply(this,arguments)}}function Tc(e,t,s){return t=s?i:t,t=e&&t==null?e.length:t,Et(e,he,i,i,i,i,t)}function qc(e,t){var s;if(typeof t!="function")throw new Je(d);return e=z(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=i),s}}var $n=V(function(e,t,s){var c=re;if(s.length){var u=Mt(s,Ii($n));c|=G}return Et(e,c,t,s,u)}),jc=V(function(e,t,s){var c=re|X;if(s.length){var u=Mt(s,Ii(jc));c|=G}return Et(t,c,e,s,u)});function Uc(e,t,s){t=s?i:t;var c=Et(e,se,i,i,i,i,i,t);return c.placeholder=Uc.placeholder,c}function Mc(e,t,s){t=s?i:t;var c=Et(e,ee,i,i,i,i,i,t);return c.placeholder=Mc.placeholder,c}function kc(e,t,s){var c,u,p,f,g,v,E=0,I=!1,P=!1,N=!0;if(typeof e!="function")throw new Je(d);t=tt(t)||0,ce(s)&&(I=!!s.leading,P="maxWait"in s,p=P?ge(tt(s.maxWait)||0,t):p,N="trailing"in s?!!s.trailing:N);function $(pe){var ut=c,Ot=u;return c=u=i,E=pe,f=e.apply(Ot,ut),f}function q(pe){return E=pe,g=er(K,t),I?$(pe):f}function L(pe){var ut=pe-v,Ot=pe-E,su=t-ut;return P?Ee(su,p-Ot):su}function j(pe){var ut=pe-v,Ot=pe-E;return v===i||ut>=t||ut<0||P&&Ot>=p}function K(){var pe=is();if(j(pe))return F(pe);g=er(K,L(pe))}function F(pe){return g=i,N&&c?$(pe):(c=u=i,f)}function Ke(){g!==i&&Qa(g),E=0,c=v=u=g=i}function Ce(){return g===i?f:F(is())}function He(){var pe=is(),ut=j(pe);if(c=arguments,u=this,v=pe,ut){if(g===i)return q(v);if(P)return Qa(g),g=er(K,t),$(v)}return g===i&&(g=er(K,t)),f}return He.cancel=Ke,He.flush=Ce,He}var Xg=V(function(e,t){return Na(e,1,t)}),ey=V(function(e,t,s){return Na(e,tt(t)||0,s)});function ty(e){return Et(e,Tt)}function rs(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new Je(d);var s=function(){var c=arguments,u=t?t.apply(this,c):c[0],p=s.cache;if(p.has(u))return p.get(u);var f=e.apply(this,c);return s.cache=p.set(u,f)||p,f};return s.cache=new(rs.Cache||_t),s}rs.Cache=_t;function ss(e){if(typeof e!="function")throw new Je(d);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function iy(e){return qc(2,e)}var ry=Vd(function(e,t){t=t.length==1&&k(t[0])?ne(t[0],ze(T())):ne(_e(t,1),ze(T()));var s=t.length;return V(function(c){for(var u=-1,p=Ee(c.length,s);++u<p;)c[u]=t[u].call(this,c[u]);return ke(e,this,c)})}),Dn=V(function(e,t){var s=Mt(t,Ii(Dn));return Et(e,G,i,t,s)}),zc=V(function(e,t){var s=Mt(t,Ii(zc));return Et(e,ye,i,t,s)}),sy=It(function(e,t){return Et(e,Re,i,i,i,t)});function ny(e,t){if(typeof e!="function")throw new Je(d);return t=t===i?t:z(t),V(e,t)}function oy(e,t){if(typeof e!="function")throw new Je(d);return t=t==null?0:ge(z(t),0),V(function(s){var c=s[t],u=Kt(s,0,t);return c&&Ut(u,c),ke(e,this,u)})}function ay(e,t,s){var c=!0,u=!0;if(typeof e!="function")throw new Je(d);return ce(s)&&(c="leading"in s?!!s.leading:c,u="trailing"in s?!!s.trailing:u),kc(e,t,{leading:c,maxWait:t,trailing:u})}function cy(e){return Tc(e,1)}function uy(e,t){return Dn(yn(t),e)}function hy(){if(!arguments.length)return[];var e=arguments[0];return k(e)?e:[e]}function ly(e){return Ze(e,Q)}function py(e,t){return t=typeof t=="function"?t:i,Ze(e,Q,t)}function dy(e){return Ze(e,O|Q)}function fy(e,t){return t=typeof t=="function"?t:i,Ze(e,O|Q,t)}function gy(e,t){return t==null||Oa(e,t,me(t))}function ct(e,t){return e===t||e!==e&&t!==t}var yy=Jr(sn),my=Jr(function(e,t){return e>=t}),oi=Aa(function(){return arguments}())?Aa:function(e){return ue(e)&&J.call(e,"callee")&&!wa.call(e,"callee")},k=_.isArray,vy=ea?ze(ea):Sd;function Te(e){return e!=null&&ns(e.length)&&!St(e)}function le(e){return ue(e)&&Te(e)}function wy(e){return e===!0||e===!1||ue(e)&&Oe(e)==Ti}var Ht=Dp||Kn,_y=ta?ze(ta):Rd;function by(e){return ue(e)&&e.nodeType===1&&!tr(e)}function Ey(e){if(e==null)return!0;if(Te(e)&&(k(e)||typeof e=="string"||typeof e.splice=="function"||Ht(e)||Pi(e)||oi(e)))return!e.length;var t=Ie(e);if(t==st||t==nt)return!e.size;if(Xi(e))return!an(e).length;for(var s in e)if(J.call(e,s))return!1;return!0}function Iy(e,t){return Ji(e,t)}function Py(e,t,s){s=typeof s=="function"?s:i;var c=s?s(e,t):i;return c===i?Ji(e,t,i,s):!!c}function An(e){if(!ue(e))return!1;var t=Oe(e);return t==mr||t==Gh||typeof e.message=="string"&&typeof e.name=="string"&&!tr(e)}function Sy(e){return typeof e=="number"&&ba(e)}function St(e){if(!ce(e))return!1;var t=Oe(e);return t==vr||t==No||t==Fh||t==Wh}function Lc(e){return typeof e=="number"&&e==z(e)}function ns(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=qt}function ce(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function ue(e){return e!=null&&typeof e=="object"}var Vc=ia?ze(ia):Nd;function Ry(e,t){return e===t||on(e,t,In(t))}function Oy(e,t,s){return s=typeof s=="function"?s:i,on(e,t,In(t),s)}function Ny(e){return Kc(e)&&e!=+e}function Cy(e){if(pf(e))throw new M(h);return Ta(e)}function xy(e){return e===null}function $y(e){return e==null}function Kc(e){return typeof e=="number"||ue(e)&&Oe(e)==ji}function tr(e){if(!ue(e)||Oe(e)!=vt)return!1;var t=Dr(e);if(t===null)return!0;var s=J.call(t,"constructor")&&t.constructor;return typeof s=="function"&&s instanceof s&&Nr.call(s)==Rp}var Tn=ra?ze(ra):Cd;function Dy(e){return Lc(e)&&e>=-qt&&e<=qt}var Hc=sa?ze(sa):xd;function os(e){return typeof e=="string"||!k(e)&&ue(e)&&Oe(e)==Mi}function Ve(e){return typeof e=="symbol"||ue(e)&&Oe(e)==wr}var Pi=na?ze(na):$d;function Ay(e){return e===i}function Ty(e){return ue(e)&&Ie(e)==ki}function qy(e){return ue(e)&&Oe(e)==Jh}var jy=Jr(cn),Uy=Jr(function(e,t){return e<=t});function Fc(e){if(!e)return[];if(Te(e))return os(e)?ot(e):Ae(e);if(Vi&&e[Vi])return fp(e[Vi]());var t=Ie(e),s=t==st?Ws:t==nt?Sr:Si;return s(e)}function Rt(e){if(!e)return e===0?e:0;if(e=tt(e),e===Yt||e===-Yt){var t=e<0?-1:1;return t*Lh}return e===e?e:0}function z(e){var t=Rt(e),s=t%1;return t===t?s?t-s:t:0}function Gc(e){return e?ii(z(e),0,pt):0}function tt(e){if(typeof e=="number")return e;if(Ve(e))return gr;if(ce(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ce(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=la(e);var s=ml.test(e);return s||wl.test(e)?Yl(e.slice(2),s?2:8):yl.test(e)?gr:+e}function Bc(e){return ft(e,qe(e))}function My(e){return e?ii(z(e),-qt,qt):e===0?e:0}function W(e){return e==null?"":Le(e)}var ky=bi(function(e,t){if(Xi(t)||Te(t)){ft(t,me(t),e);return}for(var s in t)J.call(t,s)&&Bi(e,s,t[s])}),Wc=bi(function(e,t){ft(t,qe(t),e)}),as=bi(function(e,t,s,c){ft(t,qe(t),e,c)}),zy=bi(function(e,t,s,c){ft(t,me(t),e,c)}),Ly=It(en);function Vy(e,t){var s=_i(e);return t==null?s:Ra(s,t)}var Ky=V(function(e,t){e=Z(e);var s=-1,c=t.length,u=c>2?t[2]:i;for(u&&Ne(t[0],t[1],u)&&(c=1);++s<c;)for(var p=t[s],f=qe(p),g=-1,v=f.length;++g<v;){var E=f[g],I=e[E];(I===i||ct(I,mi[E])&&!J.call(e,E))&&(e[E]=p[E])}return e}),Hy=V(function(e){return e.push(i,lc),ke(Qc,i,e)});function Fy(e,t){return aa(e,T(t,3),dt)}function Gy(e,t){return aa(e,T(t,3),rn)}function By(e,t){return e==null?e:tn(e,T(t,3),qe)}function Wy(e,t){return e==null?e:$a(e,T(t,3),qe)}function Qy(e,t){return e&&dt(e,T(t,3))}function Jy(e,t){return e&&rn(e,T(t,3))}function Yy(e){return e==null?[]:Vr(e,me(e))}function Zy(e){return e==null?[]:Vr(e,qe(e))}function qn(e,t,s){var c=e==null?i:ri(e,t);return c===i?s:c}function Xy(e,t){return e!=null&&fc(e,t,bd)}function jn(e,t){return e!=null&&fc(e,t,Ed)}var em=oc(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=Cr.call(t)),e[t]=s},Mn(je)),tm=oc(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=Cr.call(t)),J.call(e,t)?e[t].push(s):e[t]=[s]},T),im=V(Qi);function me(e){return Te(e)?Pa(e):an(e)}function qe(e){return Te(e)?Pa(e,!0):Dd(e)}function rm(e,t){var s={};return t=T(t,3),dt(e,function(c,u,p){bt(s,t(c,u,p),c)}),s}function sm(e,t){var s={};return t=T(t,3),dt(e,function(c,u,p){bt(s,u,t(c,u,p))}),s}var nm=bi(function(e,t,s){Kr(e,t,s)}),Qc=bi(function(e,t,s,c){Kr(e,t,s,c)}),om=It(function(e,t){var s={};if(e==null)return s;var c=!1;t=ne(t,function(p){return p=Vt(p,e),c||(c=p.length>1),p}),ft(e,bn(e),s),c&&(s=Ze(s,O|D|Q,Xd));for(var u=t.length;u--;)dn(s,t[u]);return s});function am(e,t){return Jc(e,ss(T(t)))}var cm=It(function(e,t){return e==null?{}:Td(e,t)});function Jc(e,t){if(e==null)return{};var s=ne(bn(e),function(c){return[c]});return t=T(t),La(e,s,function(c,u){return t(c,u[0])})}function um(e,t,s){t=Vt(t,e);var c=-1,u=t.length;for(u||(u=1,e=i);++c<u;){var p=e==null?i:e[gt(t[c])];p===i&&(c=u,p=s),e=St(p)?p.call(e):p}return e}function hm(e,t,s){return e==null?e:Yi(e,t,s)}function lm(e,t,s,c){return c=typeof c=="function"?c:i,e==null?e:Yi(e,t,s,c)}var Yc=uc(me),Zc=uc(qe);function pm(e,t,s){var c=k(e),u=c||Ht(e)||Pi(e);if(t=T(t,4),s==null){var p=e&&e.constructor;u?s=c?new p:[]:ce(e)?s=St(p)?_i(Dr(e)):{}:s={}}return(u?Qe:dt)(e,function(f,g,v){return t(s,f,g,v)}),s}function dm(e,t){return e==null?!0:dn(e,t)}function fm(e,t,s){return e==null?e:Ga(e,t,yn(s))}function gm(e,t,s,c){return c=typeof c=="function"?c:i,e==null?e:Ga(e,t,yn(s),c)}function Si(e){return e==null?[]:Bs(e,me(e))}function ym(e){return e==null?[]:Bs(e,qe(e))}function mm(e,t,s){return s===i&&(s=t,t=i),s!==i&&(s=tt(s),s=s===s?s:0),t!==i&&(t=tt(t),t=t===t?t:0),ii(tt(e),t,s)}function vm(e,t,s){return t=Rt(t),s===i?(s=t,t=0):s=Rt(s),e=tt(e),Id(e,t,s)}function wm(e,t,s){if(s&&typeof s!="boolean"&&Ne(e,t,s)&&(t=s=i),s===i&&(typeof t=="boolean"?(s=t,t=i):typeof e=="boolean"&&(s=e,e=i)),e===i&&t===i?(e=0,t=1):(e=Rt(e),t===i?(t=e,e=0):t=Rt(t)),e>t){var c=e;e=t,t=c}if(s||e%1||t%1){var u=Ea();return Ee(e+u*(t-e+Jl("1e-"+((u+"").length-1))),t)}return hn(e,t)}var _m=Ei(function(e,t,s){return t=t.toLowerCase(),e+(s?Xc(t):t)});function Xc(e){return Un(W(e).toLowerCase())}function eu(e){return e=W(e),e&&e.replace(bl,up).replace(zl,"")}function bm(e,t,s){e=W(e),t=Le(t);var c=e.length;s=s===i?c:ii(z(s),0,c);var u=s;return s-=t.length,s>=0&&e.slice(s,u)==t}function Em(e){return e=W(e),e&&tl.test(e)?e.replace($o,hp):e}function Im(e){return e=W(e),e&&al.test(e)?e.replace($s,"\\$&"):e}var Pm=Ei(function(e,t,s){return e+(s?"-":"")+t.toLowerCase()}),Sm=Ei(function(e,t,s){return e+(s?" ":"")+t.toLowerCase()}),Rm=rc("toLowerCase");function Om(e,t,s){e=W(e),t=z(t);var c=t?gi(e):0;if(!t||c>=t)return e;var u=(t-c)/2;return Qr(jr(u),s)+e+Qr(qr(u),s)}function Nm(e,t,s){e=W(e),t=z(t);var c=t?gi(e):0;return t&&c<t?e+Qr(t-c,s):e}function Cm(e,t,s){e=W(e),t=z(t);var c=t?gi(e):0;return t&&c<t?Qr(t-c,s)+e:e}function xm(e,t,s){return s||t==null?t=0:t&&(t=+t),jp(W(e).replace(Ds,""),t||0)}function $m(e,t,s){return(s?Ne(e,t,s):t===i)?t=1:t=z(t),ln(W(e),t)}function Dm(){var e=arguments,t=W(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var Am=Ei(function(e,t,s){return e+(s?"_":"")+t.toLowerCase()});function Tm(e,t,s){return s&&typeof s!="number"&&Ne(e,t,s)&&(t=s=i),s=s===i?pt:s>>>0,s?(e=W(e),e&&(typeof t=="string"||t!=null&&!Tn(t))&&(t=Le(t),!t&&fi(e))?Kt(ot(e),0,s):e.split(t,s)):[]}var qm=Ei(function(e,t,s){return e+(s?" ":"")+Un(t)});function jm(e,t,s){return e=W(e),s=s==null?0:ii(z(s),0,e.length),t=Le(t),e.slice(s,s+t.length)==t}function Um(e,t,s){var c=l.templateSettings;s&&Ne(e,t,s)&&(t=i),e=W(e),t=as({},t,c,hc);var u=as({},t.imports,c.imports,hc),p=me(u),f=Bs(u,p),g,v,E=0,I=t.interpolate||_r,P="__p += '",N=Qs((t.escape||_r).source+"|"+I.source+"|"+(I===Do?gl:_r).source+"|"+(t.evaluate||_r).source+"|$","g"),$="//# sourceURL="+(J.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Fl+"]")+`
`;e.replace(N,function(j,K,F,Ke,Ce,He){return F||(F=Ke),P+=e.slice(E,He).replace(El,lp),K&&(g=!0,P+=`' +
__e(`+K+`) +
'`),Ce&&(v=!0,P+=`';
`+Ce+`;
__p += '`),F&&(P+=`' +
((__t = (`+F+`)) == null ? '' : __t) +
'`),E=He+j.length,j}),P+=`';
`;var q=J.call(t,"variable")&&t.variable;if(!q)P=`with (obj) {
`+P+`
}
`;else if(dl.test(q))throw new M(y);P=(v?P.replace(Yh,""):P).replace(Zh,"$1").replace(Xh,"$1;"),P="function("+(q||"obj")+`) {
`+(q?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(g?", __e = _.escape":"")+(v?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+P+`return __p
}`;var L=iu(function(){return B(p,$+"return "+P).apply(i,f)});if(L.source=P,An(L))throw L;return L}function Mm(e){return W(e).toLowerCase()}function km(e){return W(e).toUpperCase()}function zm(e,t,s){if(e=W(e),e&&(s||t===i))return la(e);if(!e||!(t=Le(t)))return e;var c=ot(e),u=ot(t),p=pa(c,u),f=da(c,u)+1;return Kt(c,p,f).join("")}function Lm(e,t,s){if(e=W(e),e&&(s||t===i))return e.slice(0,ga(e)+1);if(!e||!(t=Le(t)))return e;var c=ot(e),u=da(c,ot(t))+1;return Kt(c,0,u).join("")}function Vm(e,t,s){if(e=W(e),e&&(s||t===i))return e.replace(Ds,"");if(!e||!(t=Le(t)))return e;var c=ot(e),u=pa(c,ot(t));return Kt(c,u).join("")}function Km(e,t){var s=qh,c=jh;if(ce(t)){var u="separator"in t?t.separator:u;s="length"in t?z(t.length):s,c="omission"in t?Le(t.omission):c}e=W(e);var p=e.length;if(fi(e)){var f=ot(e);p=f.length}if(s>=p)return e;var g=s-gi(c);if(g<1)return c;var v=f?Kt(f,0,g).join(""):e.slice(0,g);if(u===i)return v+c;if(f&&(g+=v.length-g),Tn(u)){if(e.slice(g).search(u)){var E,I=v;for(u.global||(u=Qs(u.source,W(Ao.exec(u))+"g")),u.lastIndex=0;E=u.exec(I);)var P=E.index;v=v.slice(0,P===i?g:P)}}else if(e.indexOf(Le(u),g)!=g){var N=v.lastIndexOf(u);N>-1&&(v=v.slice(0,N))}return v+c}function Hm(e){return e=W(e),e&&el.test(e)?e.replace(xo,vp):e}var Fm=Ei(function(e,t,s){return e+(s?" ":"")+t.toUpperCase()}),Un=rc("toUpperCase");function tu(e,t,s){return e=W(e),t=s?i:t,t===i?dp(e)?bp(e):sp(e):e.match(t)||[]}var iu=V(function(e,t){try{return ke(e,i,t)}catch(s){return An(s)?s:new M(s)}}),Gm=It(function(e,t){return Qe(t,function(s){s=gt(s),bt(e,s,$n(e[s],e))}),e});function Bm(e){var t=e==null?0:e.length,s=T();return e=t?ne(e,function(c){if(typeof c[1]!="function")throw new Je(d);return[s(c[0]),c[1]]}):[],V(function(c){for(var u=-1;++u<t;){var p=e[u];if(ke(p[0],this,c))return ke(p[1],this,c)}})}function Wm(e){return vd(Ze(e,O))}function Mn(e){return function(){return e}}function Qm(e,t){return e==null||e!==e?t:e}var Jm=nc(),Ym=nc(!0);function je(e){return e}function kn(e){return qa(typeof e=="function"?e:Ze(e,O))}function Zm(e){return Ua(Ze(e,O))}function Xm(e,t){return Ma(e,Ze(t,O))}var ev=V(function(e,t){return function(s){return Qi(s,e,t)}}),tv=V(function(e,t){return function(s){return Qi(e,s,t)}});function zn(e,t,s){var c=me(t),u=Vr(t,c);s==null&&!(ce(t)&&(u.length||!c.length))&&(s=t,t=e,e=this,u=Vr(t,me(t)));var p=!(ce(s)&&"chain"in s)||!!s.chain,f=St(e);return Qe(u,function(g){var v=t[g];e[g]=v,f&&(e.prototype[g]=function(){var E=this.__chain__;if(p||E){var I=e(this.__wrapped__),P=I.__actions__=Ae(this.__actions__);return P.push({func:v,args:arguments,thisArg:e}),I.__chain__=E,I}return v.apply(e,Ut([this.value()],arguments))})}),e}function iv(){return we._===this&&(we._=Op),this}function Ln(){}function rv(e){return e=z(e),V(function(t){return ka(t,e)})}var sv=vn(ne),nv=vn(oa),ov=vn(Vs);function ru(e){return Sn(e)?Ks(gt(e)):qd(e)}function av(e){return function(t){return e==null?i:ri(e,t)}}var cv=ac(),uv=ac(!0);function Vn(){return[]}function Kn(){return!1}function hv(){return{}}function lv(){return""}function pv(){return!0}function dv(e,t){if(e=z(e),e<1||e>qt)return[];var s=pt,c=Ee(e,pt);t=T(t),e-=pt;for(var u=Gs(c,t);++s<e;)t(s);return u}function fv(e){return k(e)?ne(e,gt):Ve(e)?[e]:Ae(Ic(W(e)))}function gv(e){var t=++Sp;return W(e)+t}var yv=Wr(function(e,t){return e+t},0),mv=wn("ceil"),vv=Wr(function(e,t){return e/t},1),wv=wn("floor");function _v(e){return e&&e.length?Lr(e,je,sn):i}function bv(e,t){return e&&e.length?Lr(e,T(t,2),sn):i}function Ev(e){return ua(e,je)}function Iv(e,t){return ua(e,T(t,2))}function Pv(e){return e&&e.length?Lr(e,je,cn):i}function Sv(e,t){return e&&e.length?Lr(e,T(t,2),cn):i}var Rv=Wr(function(e,t){return e*t},1),Ov=wn("round"),Nv=Wr(function(e,t){return e-t},0);function Cv(e){return e&&e.length?Fs(e,je):0}function xv(e,t){return e&&e.length?Fs(e,T(t,2)):0}return l.after=Zg,l.ary=Tc,l.assign=ky,l.assignIn=Wc,l.assignInWith=as,l.assignWith=zy,l.at=Ly,l.before=qc,l.bind=$n,l.bindAll=Gm,l.bindKey=jc,l.castArray=hy,l.chain=$c,l.chunk=wf,l.compact=_f,l.concat=bf,l.cond=Bm,l.conforms=Wm,l.constant=Mn,l.countBy=Cg,l.create=Vy,l.curry=Uc,l.curryRight=Mc,l.debounce=kc,l.defaults=Ky,l.defaultsDeep=Hy,l.defer=Xg,l.delay=ey,l.difference=Ef,l.differenceBy=If,l.differenceWith=Pf,l.drop=Sf,l.dropRight=Rf,l.dropRightWhile=Of,l.dropWhile=Nf,l.fill=Cf,l.filter=$g,l.flatMap=Tg,l.flatMapDeep=qg,l.flatMapDepth=jg,l.flatten=Oc,l.flattenDeep=xf,l.flattenDepth=$f,l.flip=ty,l.flow=Jm,l.flowRight=Ym,l.fromPairs=Df,l.functions=Yy,l.functionsIn=Zy,l.groupBy=Ug,l.initial=Tf,l.intersection=qf,l.intersectionBy=jf,l.intersectionWith=Uf,l.invert=em,l.invertBy=tm,l.invokeMap=kg,l.iteratee=kn,l.keyBy=zg,l.keys=me,l.keysIn=qe,l.map=ts,l.mapKeys=rm,l.mapValues=sm,l.matches=Zm,l.matchesProperty=Xm,l.memoize=rs,l.merge=nm,l.mergeWith=Qc,l.method=ev,l.methodOf=tv,l.mixin=zn,l.negate=ss,l.nthArg=rv,l.omit=om,l.omitBy=am,l.once=iy,l.orderBy=Lg,l.over=sv,l.overArgs=ry,l.overEvery=nv,l.overSome=ov,l.partial=Dn,l.partialRight=zc,l.partition=Vg,l.pick=cm,l.pickBy=Jc,l.property=ru,l.propertyOf=av,l.pull=Lf,l.pullAll=Cc,l.pullAllBy=Vf,l.pullAllWith=Kf,l.pullAt=Hf,l.range=cv,l.rangeRight=uv,l.rearg=sy,l.reject=Fg,l.remove=Ff,l.rest=ny,l.reverse=Cn,l.sampleSize=Bg,l.set=hm,l.setWith=lm,l.shuffle=Wg,l.slice=Gf,l.sortBy=Yg,l.sortedUniq=Xf,l.sortedUniqBy=eg,l.split=Tm,l.spread=oy,l.tail=tg,l.take=ig,l.takeRight=rg,l.takeRightWhile=sg,l.takeWhile=ng,l.tap=_g,l.throttle=ay,l.thru=es,l.toArray=Fc,l.toPairs=Yc,l.toPairsIn=Zc,l.toPath=fv,l.toPlainObject=Bc,l.transform=pm,l.unary=cy,l.union=og,l.unionBy=ag,l.unionWith=cg,l.uniq=ug,l.uniqBy=hg,l.uniqWith=lg,l.unset=dm,l.unzip=xn,l.unzipWith=xc,l.update=fm,l.updateWith=gm,l.values=Si,l.valuesIn=ym,l.without=pg,l.words=tu,l.wrap=uy,l.xor=dg,l.xorBy=fg,l.xorWith=gg,l.zip=yg,l.zipObject=mg,l.zipObjectDeep=vg,l.zipWith=wg,l.entries=Yc,l.entriesIn=Zc,l.extend=Wc,l.extendWith=as,zn(l,l),l.add=yv,l.attempt=iu,l.camelCase=_m,l.capitalize=Xc,l.ceil=mv,l.clamp=mm,l.clone=ly,l.cloneDeep=dy,l.cloneDeepWith=fy,l.cloneWith=py,l.conformsTo=gy,l.deburr=eu,l.defaultTo=Qm,l.divide=vv,l.endsWith=bm,l.eq=ct,l.escape=Em,l.escapeRegExp=Im,l.every=xg,l.find=Dg,l.findIndex=Sc,l.findKey=Fy,l.findLast=Ag,l.findLastIndex=Rc,l.findLastKey=Gy,l.floor=wv,l.forEach=Dc,l.forEachRight=Ac,l.forIn=By,l.forInRight=Wy,l.forOwn=Qy,l.forOwnRight=Jy,l.get=qn,l.gt=yy,l.gte=my,l.has=Xy,l.hasIn=jn,l.head=Nc,l.identity=je,l.includes=Mg,l.indexOf=Af,l.inRange=vm,l.invoke=im,l.isArguments=oi,l.isArray=k,l.isArrayBuffer=vy,l.isArrayLike=Te,l.isArrayLikeObject=le,l.isBoolean=wy,l.isBuffer=Ht,l.isDate=_y,l.isElement=by,l.isEmpty=Ey,l.isEqual=Iy,l.isEqualWith=Py,l.isError=An,l.isFinite=Sy,l.isFunction=St,l.isInteger=Lc,l.isLength=ns,l.isMap=Vc,l.isMatch=Ry,l.isMatchWith=Oy,l.isNaN=Ny,l.isNative=Cy,l.isNil=$y,l.isNull=xy,l.isNumber=Kc,l.isObject=ce,l.isObjectLike=ue,l.isPlainObject=tr,l.isRegExp=Tn,l.isSafeInteger=Dy,l.isSet=Hc,l.isString=os,l.isSymbol=Ve,l.isTypedArray=Pi,l.isUndefined=Ay,l.isWeakMap=Ty,l.isWeakSet=qy,l.join=Mf,l.kebabCase=Pm,l.last=et,l.lastIndexOf=kf,l.lowerCase=Sm,l.lowerFirst=Rm,l.lt=jy,l.lte=Uy,l.max=_v,l.maxBy=bv,l.mean=Ev,l.meanBy=Iv,l.min=Pv,l.minBy=Sv,l.stubArray=Vn,l.stubFalse=Kn,l.stubObject=hv,l.stubString=lv,l.stubTrue=pv,l.multiply=Rv,l.nth=zf,l.noConflict=iv,l.noop=Ln,l.now=is,l.pad=Om,l.padEnd=Nm,l.padStart=Cm,l.parseInt=xm,l.random=wm,l.reduce=Kg,l.reduceRight=Hg,l.repeat=$m,l.replace=Dm,l.result=um,l.round=Ov,l.runInContext=m,l.sample=Gg,l.size=Qg,l.snakeCase=Am,l.some=Jg,l.sortedIndex=Bf,l.sortedIndexBy=Wf,l.sortedIndexOf=Qf,l.sortedLastIndex=Jf,l.sortedLastIndexBy=Yf,l.sortedLastIndexOf=Zf,l.startCase=qm,l.startsWith=jm,l.subtract=Nv,l.sum=Cv,l.sumBy=xv,l.template=Um,l.times=dv,l.toFinite=Rt,l.toInteger=z,l.toLength=Gc,l.toLower=Mm,l.toNumber=tt,l.toSafeInteger=My,l.toString=W,l.toUpper=km,l.trim=zm,l.trimEnd=Lm,l.trimStart=Vm,l.truncate=Km,l.unescape=Hm,l.uniqueId=gv,l.upperCase=Fm,l.upperFirst=Un,l.each=Dc,l.eachRight=Ac,l.first=Nc,zn(l,function(){var e={};return dt(l,function(t,s){J.call(l.prototype,s)||(e[s]=t)}),e}(),{chain:!1}),l.VERSION=n,Qe(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){l[e].placeholder=l}),Qe(["drop","take"],function(e,t){H.prototype[e]=function(s){s=s===i?1:ge(z(s),0);var c=this.__filtered__&&!t?new H(this):this.clone();return c.__filtered__?c.__takeCount__=Ee(s,c.__takeCount__):c.__views__.push({size:Ee(s,pt),type:e+(c.__dir__<0?"Right":"")}),c},H.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),Qe(["filter","map","takeWhile"],function(e,t){var s=t+1,c=s==Oo||s==zh;H.prototype[e]=function(u){var p=this.clone();return p.__iteratees__.push({iteratee:T(u,3),type:s}),p.__filtered__=p.__filtered__||c,p}}),Qe(["head","last"],function(e,t){var s="take"+(t?"Right":"");H.prototype[e]=function(){return this[s](1).value()[0]}}),Qe(["initial","tail"],function(e,t){var s="drop"+(t?"":"Right");H.prototype[e]=function(){return this.__filtered__?new H(this):this[s](1)}}),H.prototype.compact=function(){return this.filter(je)},H.prototype.find=function(e){return this.filter(e).head()},H.prototype.findLast=function(e){return this.reverse().find(e)},H.prototype.invokeMap=V(function(e,t){return typeof e=="function"?new H(this):this.map(function(s){return Qi(s,e,t)})}),H.prototype.reject=function(e){return this.filter(ss(T(e)))},H.prototype.slice=function(e,t){e=z(e);var s=this;return s.__filtered__&&(e>0||t<0)?new H(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),t!==i&&(t=z(t),s=t<0?s.dropRight(-t):s.take(t-e)),s)},H.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},H.prototype.toArray=function(){return this.take(pt)},dt(H.prototype,function(e,t){var s=/^(?:filter|find|map|reject)|While$/.test(t),c=/^(?:head|last)$/.test(t),u=l[c?"take"+(t=="last"?"Right":""):t],p=c||/^find/.test(t);u&&(l.prototype[t]=function(){var f=this.__wrapped__,g=c?[1]:arguments,v=f instanceof H,E=g[0],I=v||k(f),P=function(K){var F=u.apply(l,Ut([K],g));return c&&N?F[0]:F};I&&s&&typeof E=="function"&&E.length!=1&&(v=I=!1);var N=this.__chain__,$=!!this.__actions__.length,q=p&&!N,L=v&&!$;if(!p&&I){f=L?f:new H(this);var j=e.apply(f,g);return j.__actions__.push({func:es,args:[P],thisArg:i}),new Ye(j,N)}return q&&L?e.apply(this,g):(j=this.thru(P),q?c?j.value()[0]:j.value():j)})}),Qe(["pop","push","shift","sort","splice","unshift"],function(e){var t=Rr[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);l.prototype[e]=function(){var u=arguments;if(c&&!this.__chain__){var p=this.value();return t.apply(k(p)?p:[],u)}return this[s](function(f){return t.apply(k(f)?f:[],u)})}}),dt(H.prototype,function(e,t){var s=l[t];if(s){var c=s.name+"";J.call(wi,c)||(wi[c]=[]),wi[c].push({name:t,func:s})}}),wi[Br(i,X).name]=[{name:"wrapper",func:i}],H.prototype.clone=Kp,H.prototype.reverse=Hp,H.prototype.value=Fp,l.prototype.at=bg,l.prototype.chain=Eg,l.prototype.commit=Ig,l.prototype.next=Pg,l.prototype.plant=Rg,l.prototype.reverse=Og,l.prototype.toJSON=l.prototype.valueOf=l.prototype.value=Ng,l.prototype.first=l.prototype.head,Vi&&(l.prototype[Vi]=Sg),l},yi=Ep();Zt?((Zt.exports=yi)._=yi,Ms._=yi):we._=yi}).call(sr)})(uo,uo.exports);var _1=Object.defineProperty,b1=Object.defineProperties,E1=Object.getOwnPropertyDescriptors,Ku=Object.getOwnPropertySymbols,I1=Object.prototype.hasOwnProperty,P1=Object.prototype.propertyIsEnumerable,Hu=(a,r,i)=>r in a?_1(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i,hs=(a,r)=>{for(var i in r||(r={}))I1.call(r,i)&&Hu(a,i,r[i]);if(Ku)for(var i of Ku(r))P1.call(r,i)&&Hu(a,i,r[i]);return a},S1=(a,r)=>b1(a,E1(r));function Wt(a,r,i){var n;const o=Wv(a);return((n=r.rpcMap)==null?void 0:n[o.reference])||`${w1}?chainId=${o.namespace}:${o.reference}&projectId=${i}`}function ui(a){return a.includes(":")?a.split(":")[1]:a}function Ah(a){return a.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function R1(a,r){const i=Object.keys(r.namespaces).filter(o=>o.includes(a));if(!i.length)return[];const n=[];return i.forEach(o=>{const h=r.namespaces[o].accounts;n.push(...h)}),n}function Fu(a={},r={}){const i=Gu(a),n=Gu(r);return uo.exports.merge(i,n)}function Gu(a){var r,i,n,o;const h={};if(!hr(a))return h;for(const[d,y]of Object.entries(a)){const w=_o(d)?[d]:y.chains,S=y.methods||[],C=y.events||[],O=y.rpcMap||{},D=nr(d);h[D]=S1(hs(hs({},h[D]),y),{chains:Hn(w,(r=h[D])==null?void 0:r.chains),methods:Hn(S,(i=h[D])==null?void 0:i.methods),events:Hn(C,(n=h[D])==null?void 0:n.events),rpcMap:hs(hs({},O),(o=h[D])==null?void 0:o.rpcMap)})}return h}function O1(a){return a.includes(":")?a.split(":")[2]:a}function N1(a){const r={};for(const[i,n]of Object.entries(a)){const o=n.methods||[],h=n.events||[],d=n.accounts||[],y=_o(i)?[i]:n.chains?n.chains:Ah(n.accounts);r[i]={chains:y,methods:o,events:h,accounts:d}}return r}function Zn(a){return typeof a=="number"?a:a.includes("0x")?parseInt(a,16):(a=a.includes(":")?a.split(":")[1]:a,isNaN(Number(a))?a:Number(a))}const Th={},ae=a=>Th[a],Xn=(a,r)=>{Th[a]=r};class C1{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(At.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=ui(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Wt(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Dt(new Jt(n,ae("disableProviderPing")))}}class x1{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=ae("events"),this.client=ae("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(parseInt(r),i),this.chainId=parseInt(r),this.events.emit(At.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,i){const n=i||Wt(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Dt(new Jt(n,ae("disableProviderPing")))}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=parseInt(ui(i));r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}async handleSwitchChain(r){var i,n;let o=r.request.params?(i=r.request.params[0])==null?void 0:i.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const h=parseInt(o,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:o}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}}class $1{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(At.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=ui(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Wt(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Dt(new Jt(n,ae("disableProviderPing")))}}class D1{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(At.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=ui(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Wt(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Dt(new Jt(n,ae("disableProviderPing")))}}class A1{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(At.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{const n=this.getCardanoRPCUrl(i),o=ui(i);r[o]=this.createHttpProvider(o,n)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}getCardanoRPCUrl(r){const i=this.namespace.rpcMap;if(i)return i[r]}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||this.getCardanoRPCUrl(r);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Dt(new Jt(n,ae("disableProviderPing")))}}class T1{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(At.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=ui(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Wt(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Dt(new Jt(n,ae("disableProviderPing")))}}class q1{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(At.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=ui(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Wt(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Dt(new Jt(n,ae("disableProviderPing")))}}class j1{constructor(r){this.name="near",this.namespace=r.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(this.chainId=r,!this.httpProviders[r]){const n=i||Wt(`${this.name}:${r}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.events.emit(At.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;r[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Wt(r,this.namespace);return typeof n>"u"?void 0:new Dt(new Jt(n,ae("disableProviderPing")))}}var U1=Object.defineProperty,M1=Object.defineProperties,k1=Object.getOwnPropertyDescriptors,Bu=Object.getOwnPropertySymbols,z1=Object.prototype.hasOwnProperty,L1=Object.prototype.propertyIsEnumerable,Wu=(a,r,i)=>r in a?U1(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i,ls=(a,r)=>{for(var i in r||(r={}))z1.call(r,i)&&Wu(a,i,r[i]);if(Bu)for(var i of Bu(r))L1.call(r,i)&&Wu(a,i,r[i]);return a},eo=(a,r)=>M1(a,k1(r));class So{constructor(r){this.events=new yo,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:ms(vs({level:(r==null?void 0:r.logger)||Lu})),this.disableProviderPing=(r==null?void 0:r.disableProviderPing)||!1}static async init(r){const i=new So(r);return await i.initialize(),i}async request(r,i,n){const[o,h]=this.validateChain(i);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(o).request({request:ls({},r),chainId:`${o}:${h}`,topic:this.session.topic,expiry:n})}sendAsync(r,i,n,o){const h=new Date().getTime();this.request(r,n,o).then(d=>i(null,ws(h,d))).catch(d=>i(d,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:oe("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}removeListener(r,i){this.events.removeListener(r,i)}off(r,i){this.events.off(r,i)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let i=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(i>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(h=>{this.session=h;const d=N1(h.namespaces);this.namespaces=Fu(this.namespaces,d),this.persist("namespaces",this.namespaces)}).catch(h=>{if(h.message!==$h)throw h;i++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,i){try{if(!this.session)return;const[n,o]=this.validateChain(r);this.getProvider(n).setDefaultChain(o,i)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const i=this.client.pairing.getAll();if(mt(i)){for(const n of i)r.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${i.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await g1.init({logger:this.providerOpts.logger||Lu,relayUrl:this.providerOpts.relayUrl||y1,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(i=>nr(i)))];Xn("client",this.client),Xn("events",this.events),Xn("disableProviderPing",this.disableProviderPing),r.forEach(i=>{if(!this.session)return;const n=R1(i,this.session),o=Ah(n),h=Fu(this.namespaces,this.optionalNamespaces),d=eo(ls({},h[i]),{accounts:n,chains:o});switch(i){case"eip155":this.rpcProviders[i]=new x1({namespace:d});break;case"solana":this.rpcProviders[i]=new $1({namespace:d});break;case"cosmos":this.rpcProviders[i]=new D1({namespace:d});break;case"polkadot":this.rpcProviders[i]=new C1({namespace:d});break;case"cip34":this.rpcProviders[i]=new A1({namespace:d});break;case"elrond":this.rpcProviders[i]=new T1({namespace:d});break;case"multiversx":this.rpcProviders[i]=new q1({namespace:d});break;case"near":this.rpcProviders[i]=new j1({namespace:d});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:i}=r,{event:n}=i;if(n.name==="accountsChanged"){const o=n.data;o&&mt(o)&&this.events.emit("accountsChanged",o.map(O1))}else if(n.name==="chainChanged"){const o=i.chainId,h=i.event.data,d=nr(o),y=Zn(o)!==Zn(h)?`${d}:${Zn(h)}`:o;this.onChainChanged(y)}else this.events.emit(n.name,n.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:i})=>{var n;const{namespaces:o}=i,h=(n=this.client)==null?void 0:n.session.get(r);this.session=eo(ls({},h),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:i})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",eo(ls({},oe("USER_DISCONNECTED")),{data:r.topic}))}),this.on(At.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){if(!this.rpcProviders[r])throw new Error(`Provider not found: ${r}`);return this.rpcProviders[r]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var i;this.getProvider(r).updateNamespace((i=this.session)==null?void 0:i.namespaces[r])})}setNamespaces(r){const{namespaces:i,optionalNamespaces:n,sessionProperties:o}=r;i&&Object.keys(i).length&&(this.namespaces=i),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=o,this.persist("namespaces",i),this.persist("optionalNamespaces",n)}validateChain(r){const[i,n]=(r==null?void 0:r.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[i,n];if(i&&!Object.keys(this.namespaces||{}).map(d=>nr(d)).includes(i))throw new Error(`Namespace '${i}' is not configured. Please call connect() first with namespace config.`);if(i&&n)return[i,n];const o=nr(Object.keys(this.namespaces)[0]),h=this.rpcProviders[o].getDefaultChain();return[o,h]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,i=!1){if(!this.namespaces)return;const[n,o]=this.validateChain(r);o&&(i||this.getProvider(n).setDefaultChain(o),this.namespaces[n]?this.namespaces[n].defaultChain=o:this.namespaces[`${n}:${o}`]?this.namespaces[`${n}:${o}`].defaultChain=o:this.namespaces[`${n}:${o}`]={defaultChain:o},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",o))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,i){this.client.core.storage.setItem(`${Vu}/${r}`,i)}async getFromStore(r){return await this.client.core.storage.getItem(`${Vu}/${r}`)}}const V1=So,K1="wc",H1="ethereum_provider",F1=`${K1}@2:${H1}:`,G1="https://rpc.walletconnect.com/v1/",ho=["eth_sendTransaction","personal_sign"],B1=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],lo=["chainChanged","accountsChanged"],W1=["chainChanged","accountsChanged","message","disconnect","connect"];var Q1=Object.defineProperty,J1=Object.defineProperties,Y1=Object.getOwnPropertyDescriptors,Qu=Object.getOwnPropertySymbols,Z1=Object.prototype.hasOwnProperty,X1=Object.prototype.propertyIsEnumerable,Ju=(a,r,i)=>r in a?Q1(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i,ar=(a,r)=>{for(var i in r||(r={}))Z1.call(r,i)&&Ju(a,i,r[i]);if(Qu)for(var i of Qu(r))X1.call(r,i)&&Ju(a,i,r[i]);return a},Yu=(a,r)=>J1(a,Y1(r));function ys(a){return Number(a[0].split(":")[1])}function to(a){return`0x${a.toString(16)}`}function eE(a){const{chains:r,optionalChains:i,methods:n,optionalMethods:o,events:h,optionalEvents:d,rpcMap:y}=a;if(!mt(r))throw new Error("Invalid chains");const w={chains:r,methods:n||ho,events:h||lo,rpcMap:ar({},r.length?{[ys(r)]:y[ys(r)]}:{})},S=h==null?void 0:h.filter(Q=>!lo.includes(Q)),C=n==null?void 0:n.filter(Q=>!ho.includes(Q));if(!i&&!d&&!o&&!(S!=null&&S.length)&&!(C!=null&&C.length))return{required:r.length?w:void 0};const O=(S==null?void 0:S.length)&&(C==null?void 0:C.length)||!i,D={chains:[...new Set(O?w.chains.concat(i||[]):i)],methods:[...new Set(w.methods.concat(o!=null&&o.length?o:B1))],events:[...new Set(w.events.concat(d!=null&&d.length?d:W1))],rpcMap:y};return{required:r.length?w:void 0,optional:i.length?D:void 0}}class Ro{constructor(){this.events=new Qt.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=F1,this.on=(r,i)=>(this.events.on(r,i),this),this.once=(r,i)=>(this.events.once(r,i),this),this.removeListener=(r,i)=>(this.events.removeListener(r,i),this),this.off=(r,i)=>(this.events.off(r,i),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const i=new Ro;return await i.initialize(r),i}async request(r,i){return await this.signer.request(r,this.formatChainId(this.chainId),i)}sendAsync(r,i,n){this.signer.sendAsync(r,i,this.formatChainId(this.chainId),n)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:i,optional:n}=eE(this.rpc);try{const o=await new Promise(async(d,y)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(S=>{!S.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),y(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Yu(ar({namespaces:ar({},i&&{[this.namespace]:i})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:r==null?void 0:r.pairingTopic})).then(S=>{d(S)}).catch(S=>{y(new Error(S.message))})});if(!o)return;const h=Qv(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:h),this.setAccounts(h),this.events.emit("connect",{chainId:to(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:i}=r,{event:n}=i;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const i=parseInt(r);this.chainId=i,this.events.emit("chainChanged",to(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",Yu(ar({},oe("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var i,n;this.rpc.showQrModal&&((i=this.modal)==null||i.closeModal(),(n=this.modal)==null||n.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const i=r.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));i.length&&(this.chainId=i[0],this.events.emit("chainChanged",to(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const i=this.parseChainId(r);this.chainId=i,this.switchEthereumChain(i)}}parseAccountId(r){const[i,n,o]=r.split(":");return{chainId:`${i}:${n}`,address:o}}setAccounts(r){this.accounts=r.filter(i=>this.parseChainId(this.parseAccountId(i).chainId)===this.chainId).map(i=>this.parseAccountId(i).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var i,n;const o=(i=r==null?void 0:r.chains)!=null?i:[],h=(n=r==null?void 0:r.optionalChains)!=null?n:[],d=o.concat(h);if(!d.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const y=o.length?(r==null?void 0:r.methods)||ho:[],w=o.length?(r==null?void 0:r.events)||lo:[],S=(r==null?void 0:r.optionalMethods)||[],C=(r==null?void 0:r.optionalEvents)||[],O=(r==null?void 0:r.rpcMap)||this.buildRpcMap(d,r.projectId),D=(r==null?void 0:r.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(Q=>this.formatChainId(Q)),optionalChains:h.map(Q=>this.formatChainId(Q)),methods:y,events:w,optionalMethods:S,optionalEvents:C,rpcMap:O,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:D,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,i){const n={};return r.forEach(o=>{n[o]=this.getRpcUrl(o,i)}),n}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?ys(this.rpc.chains):ys(this.rpc.optionalChains),this.signer=await V1.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let i;try{const{WalletConnectModal:n}=await Gv(()=>import("./index-XiqWboAF.js").then(o=>o.i),__vite__mapDeps([0,1,2]),import.meta.url);i=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(i)try{this.modal=new i(ar({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:i,optionalChains:n,rpcMap:o}=r;i&&mt(i)&&(this.rpc.chains=i.map(h=>this.formatChainId(h)),i.forEach(h=>{this.rpc.rpcMap[h]=(o==null?void 0:o[h])||this.getRpcUrl(h)})),n&&mt(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(h=>this.formatChainId(h)),n.forEach(h=>{this.rpc.rpcMap[h]=(o==null?void 0:o[h])||this.getRpcUrl(h)}))}getRpcUrl(r,i){var n;return((n=this.rpc.rpcMap)==null?void 0:n[r])||`${G1}?chainId=eip155:${r}&projectId=${i||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),i=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:i==null?void 0:i.accounts),this.setAccounts(i==null?void 0:i.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(i=>this.parseAccount(i))}}const lE=Ro;export{lE as EthereumProvider,W1 as OPTIONAL_EVENTS,B1 as OPTIONAL_METHODS,lo as REQUIRED_EVENTS,ho as REQUIRED_METHODS,Ro as default};
